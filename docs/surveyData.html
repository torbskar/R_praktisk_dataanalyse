<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Veldig praktisk dataanalyse med R - 1&nbsp; Håndtering av data med innebygd metadata</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Håndtering av data med innebygd metadata</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Veldig praktisk dataanalyse med R</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Forord</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveyData.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Håndtering av data med innebygd metadata</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#intro-dataformater" id="toc-intro-dataformater" class="nav-link active" data-scroll-target="#intro-dataformater"><span class="toc-section-number">1.1</span>  Intro: Dataformater</a></li>
  <li><a href="#noen-dataformater-typisk-for-norske-surveydata" id="toc-noen-dataformater-typisk-for-norske-surveydata" class="nav-link" data-scroll-target="#noen-dataformater-typisk-for-norske-surveydata"><span class="toc-section-number">1.2</span>  Noen dataformater typisk for norske surveydata</a></li>
  <li><a href="#suveydata-med-innebygd-metadata" id="toc-suveydata-med-innebygd-metadata" class="nav-link" data-scroll-target="#suveydata-med-innebygd-metadata"><span class="toc-section-number">1.3</span>  Suveydata med innebygd metadata</a></li>
  <li><a href="#lese-inn-data-i-stata-formatet-.dta" id="toc-lese-inn-data-i-stata-formatet-.dta" class="nav-link" data-scroll-target="#lese-inn-data-i-stata-formatet-.dta"><span class="toc-section-number">1.4</span>  Lese inn data i Stata-formatet .dta</a>
  <ul class="collapse">
  <li><a href="#innlesning-med-haven" id="toc-innlesning-med-haven" class="nav-link" data-scroll-target="#innlesning-med-haven"><span class="toc-section-number">1.4.1</span>  Innlesning med {haven}</a></li>
  </ul></li>
  <li><a href="#få-oversikt-over-dataene" id="toc-få-oversikt-over-dataene" class="nav-link" data-scroll-target="#få-oversikt-over-dataene"><span class="toc-section-number">1.5</span>  Få oversikt over dataene</a>
  <ul class="collapse">
  <li><a href="#alternativ-pakken-memisc-og-codebook" id="toc-alternativ-pakken-memisc-og-codebook" class="nav-link" data-scroll-target="#alternativ-pakken-memisc-og-codebook"><span class="toc-section-number">1.5.1</span>  Alternativ: pakken {memisc} og <em>codebook()</em></a></li>
  </ul></li>
  <li><a href="#søke-i-datasettet-etter-variable" id="toc-søke-i-datasettet-etter-variable" class="nav-link" data-scroll-target="#søke-i-datasettet-etter-variable"><span class="toc-section-number">1.6</span>  Søke i datasettet etter variable</a></li>
  <li><a href="#omkode-variable-som-er-labelled" id="toc-omkode-variable-som-er-labelled" class="nav-link" data-scroll-target="#omkode-variable-som-er-labelled"><span class="toc-section-number">1.7</span>  Omkode variable som er labelled</a>
  <ul class="collapse">
  <li><a href="#alternativ-legg-til-user-specified-na" id="toc-alternativ-legg-til-user-specified-na" class="nav-link" data-scroll-target="#alternativ-legg-til-user-specified-na"><span class="toc-section-number">1.7.1</span>  Alternativ: legg til user-specified-na</a></li>
  </ul></li>
  <li><a href="#omkoding-av-andre-verdier" id="toc-omkoding-av-andre-verdier" class="nav-link" data-scroll-target="#omkoding-av-andre-verdier"><span class="toc-section-number">1.8</span>  Omkoding av andre verdier</a></li>
  <li><a href="#konverter-variable-til-et-mer-ordinært-r-format" id="toc-konverter-variable-til-et-mer-ordinært-r-format" class="nav-link" data-scroll-target="#konverter-variable-til-et-mer-ordinært-r-format"><span class="toc-section-number">1.9</span>  Konverter variable til et mer ordinært R-format</a></li>
  <li><a href="#hvordan-gjøre-alt-i-en-fei-alle-variable-samtidig" id="toc-hvordan-gjøre-alt-i-en-fei-alle-variable-samtidig" class="nav-link" data-scroll-target="#hvordan-gjøre-alt-i-en-fei-alle-variable-samtidig"><span class="toc-section-number">1.10</span>  Hvordan gjøre alt i en fei: alle variable samtidig</a>
  <ul class="collapse">
  <li><a href="#sett-det-hele-sammen-fiks-hele-skiten-i-en-fei" id="toc-sett-det-hele-sammen-fiks-hele-skiten-i-en-fei" class="nav-link" data-scroll-target="#sett-det-hele-sammen-fiks-hele-skiten-i-en-fei"><span class="toc-section-number">1.10.1</span>  Sett det hele sammen: fiks hele skiten i en fei</a></li>
  </ul></li>
  <li><a href="#omkoding-av-factor-variable" id="toc-omkoding-av-factor-variable" class="nav-link" data-scroll-target="#omkoding-av-factor-variable"><span class="toc-section-number">1.11</span>  Omkoding av factor-variable</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Håndtering av data med innebygd metadata</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>I dette kapittelet skal vi bruke følgende pakker:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)       <span class="co"># Importere data fra SAS, SPSS og Stata</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)   <span class="co"># Pakker for generell datahåndtering og grafikk</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(labelled)    <span class="co"># Håndtering av variable med labler, importert fra annen software</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)     <span class="co"># Lettere omkoding av faktorvariable</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="intro-dataformater" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="intro-dataformater"><span class="header-section-number">1.1</span> Intro: Dataformater</h2>
<p>Det kan være ulike problemstillinger knyttet til type data, dataformater, men også hvordan noen har valgt å lagre/distribuere data. Det kan være vanskelig å skille mellom disse og man kan noen ganger lure på om det er hos R begrensningene ligger. Det kan være flere av disse, men som hovedregel er problemet at data ofte ikke er distribuert i et universelt format. Permanent lagring og distribusjon av data er krevende, men ikke temaet her. Uansett: du vil ofte få data i et format som ikke er tilrettelagt verken i eller for R. Å gjøre om data fra et format til et annet kan være en avgjørende oppgave for å få gjort noe som helst.</p>
<p>Dette kan være krøkete og du har vikelig muligheten til å kløne det til skikkelig. For at du skal slippe det gir dette kapittelet en oppskrift for å håndtere slike data slik at du kan jobbe videre med dem i R på en hensiktsmessig måte.</p>
<p>Det er også noen utfordringer i R for håndtering av factor-variable med lange (noen ganger veldig lange) ‘labler’. Det gis noen løsninger på det også som gjør kodingen håndterbar.</p>
</section>
<section id="noen-dataformater-typisk-for-norske-surveydata" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="noen-dataformater-typisk-for-norske-surveydata"><span class="header-section-number">1.2</span> Noen dataformater typisk for norske surveydata</h2>
<p>I Norge er Sikt (tidliger NSD) en stor leverandør av data til samfunnsvitenskapen. De leverer ofte data i proprietære formater som SAS, SPSS eller Stata. I tillegg vil de levere en <em>flat fil</em> som typisk er <em>comma separated variables</em> (csv). I de førstnevnte vil metadata være integrert, mens i csv er det bare kodene og metadata må slås opp i dokumentasjonen.</p>
</section>
<section id="suveydata-med-innebygd-metadata" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="suveydata-med-innebygd-metadata"><span class="header-section-number">1.3</span> Suveydata med innebygd metadata</h2>
<p>En type data som er mye brukt i samfunnsvitenskapen er surveydata, altså: data innhentet ved hjelp av spørreskjema. Slike data inneholder gjerne en god del kategoriske data eller man svarer på en likert-skala (f.eks. skala fra 1 til 5), men også kontinuerlige variable og kan også være tekstsvar.</p>
<p>Slike data er ofte <em>kodet</em> slik at bestemte verdier har en tekstlig betydning. F.eks. 1 = “gift” og 2 = “ugift”, eller 1 = “veldig fornøyd” og 5 = “veldig misfornøyd” osv.</p>
<p>I R vil slike variable normalt håndteres som såkalte faktor-variable, men ofte vil surveydata inneholde relativt lange tekstverdier som gjør det tungvint. Men det finnes løsninger. For å gjøre en lang historie kort: Surveydata er best å håndtere med pakkene {labelled}. For videre analyser er det derimot vanligvis best å ha faktor-variable, så vi vil oftest konvertere dataene etterpå. Det høres tungvindt ut, men konverteringen er bare et par linjer kode.</p>
<p>Et spesielt problem er at i Stata og SPSS vil mange datasett inneholde spesielle verdier som skal tolkes som <em>manglende data</em>, såkalt ‘missing’. Det kan altså være egne koder for om respondenten ikke fikk stilt spørsmålet, ikke ville svare, eller andre grunner. For en variabel for inntekt kan f.eks. verdien 999999 betyr at vedkommende ikke ville svare. Når vi regner et gjennomsnitt er det da viktig at akkurat disse verdiene ikke inngår i beregningen. (Å kode på denne måten kan si er en uting uansett software, så vi skal i hvert fall kvitte oss med disse).</p>
<p>I R er det flere pakker og funksjoner som er spesielt egnet til å håndtere slike data og vi skal bruke følgende:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)       <span class="co"># For å lese inn data fra SPSS, Stata eller SAS</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(labelled)    <span class="co"># For å håndtere variable og verdier som inneholder 'labler'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I tillegg skal vi bruke pakker for generell datahåndtering som er samlet i pakken {tidyverse}, deriblant en pakke {forcats} for håndtering av kategoriske variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)   <span class="co"># Generelle funksjoner for datahåndtering</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I det følgende skal vi dekke disse temaene:</p>
<ul>
<li>Hvordan lese inn data fra Stata-formatet</li>
<li>Hvordan få oversikt over datasettet</li>
<li>Hvordan omkode variable med ‘labler’</li>
<li>Hvordan håndtere verdier som er kodet som ‘missing’ i Stata-formatet (kalles user-defined-NA i R)</li>
<li>Hvordan gjøre om labelled-variable til faktor-variable</li>
<li>Hvordan gjør det ovenstående på veldig mange variable på en gang (altså: fremfor en og en, så du kan bruke tiden din på morsommere ting)</li>
</ul>
</section>
<section id="lese-inn-data-i-stata-formatet-.dta" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="lese-inn-data-i-stata-formatet-.dta"><span class="header-section-number">1.4</span> Lese inn data i Stata-formatet .dta</h2>
<p>I det følgende bruker jeg som eksempel dataene NorLag som man kan få tilgang til via NSD/Sikt her: https://norlag.nsd.no/. Disse dataene kan lastes ned i flere ulike typer formater slik data fra NSD/Sikt gjerne kan. Tilsvarende vil altså gjelde for andre datasett derfra. De ulike dataformatene er typisk tilpasset spesifikke software og det er en utfordring hvis man bruker et annet system enn det NSD har sett for seg.</p>
<p>De leverer også data i csv-format som ikke er uavhengig av software og kan leses inn av alle typer statistikksoftware. Generelt er csv-formatet å foretrekke når man skal dele data nettopp av denne grunn. Det er også et format som ikke er sårbar for endringer i softwaren over lengre tid slik at det må konverteres mellom formatversjoner. Særlig for surveydata er derimot csv-formatet ikke alltid så godt i praksis da det krever en godt opplegg for dokumentasjon og metadata som trengs i kodingen av data. NSD/Sikt har valgt en måte å dokumentere metadata på som ikke er lett håndterbart maskinelt av ikke-profesjonelle programmerere. Dette gjør csv-formatet lite egnet i dette tilfellet.</p>
<p>Derimot kan man laste ned dataene i formatene til SPSS eller Stata. Vi vil her forholde oss kun til Stata-filer, men det vil være tilsvarende med SPSS og i praksis også SAS. Stata-formatet har en filhale som slutter på ‘.dta’. Fordelen med dette formatet er at metadata er innebygd i selve dataformatet. Altså, at en kategorisk variabel vil inneholde <em>både</em> en tallkode og en tekst med informasjon om hva tallet betyr. Dette er imidlertid en måte å håndtere data på som ikke er optimal for R.</p>
<p>I det følgende skal vi dekke * Lese inn Stata-filer * Søke etter variable * Undersøke hvordan variable er kodet, se på ‘lablene’ * Gjøre omkodinger av variablene * Endre variable til faktor-variable * Omkode faktor-variable med veldig lange tekstverdier</p>
<section id="innlesning-med-haven" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="innlesning-med-haven"><span class="header-section-number">1.4.1</span> Innlesning med {haven}</h3>
<p>Formatene Stata, SPSS og SAS er proprietære og man trenger i utgangspunktet disse softwarene for å åpne datafilene (og betale dyr lisens). For å lese inn i R kan man bruke pakken {haven} som inneholder spesialiserte funksjoner for å lese inn disse formatene. Funskjonen <strong>read_stata()</strong> leser inn dataene på en måte som bevarer særegenhetene fra Stata-formatet.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>norlag <span class="ot">&lt;-</span> <span class="fu">read_stata</span>(<span class="st">"data/norlag_panel2022.dta"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="få-oversikt-over-dataene" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="få-oversikt-over-dataene"><span class="header-section-number">1.5</span> Få oversikt over dataene</h2>
<p>Vi har nå et datasett i minnet og vi bør ta en titt på det. Nå er det mange hundre variable i datasettet, så det er lite hensiktsmessig å printe det til konsollen fordi det er rett og slett ikke plass. I tidligere kurs skal dere ha lært å bruke funksjonen <em>glimpse()</em>, men også her blir det mest rotete fordi det er så mange variable.</p>
<p>En enkel løsning er å bare se på noen få variable om gangen. Med klammeparentes kan vi angi hvilke radnummer og kolonnenummer vi ønsker se på med følgende syntax: <strong>datasett[rader, kolonner]</strong> der altså komma skiller mellom rader og kolonner. Følgende eksempel viser hvordan man kan bruke <em>head()</em> for å vise de første observasjonene i datasettet med bare de første 5 variablene (altså: kollonne nr 1-5).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(norlag[, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  ref_nr round iointervjumnd                 iointervjuyr ioalder               
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl+lbl&gt;                     &lt;dbl+lbl&gt;    &lt;dbl+lbl&gt;             
1      5     1      5                          2002           68                
2      5     2     11                          2007           72                
3      5     3 999999 [Deltok ikke i runden] 999999       999999 [Deltok ikke i…
4     10     1      5                          2002           44                
5     10     2      5                          2007           49                
6     10     3      5                          2017           59                </code></pre>
</div>
</div>
<p>Legg merke til at under hvert variabelnavn står det en liten tekst, f.eks. <dbl> eller &lt;S3: haven_labelled&gt;. Det kan også stå andre ting. dbl betyr at det er en kontinuerlig variabel, mens haven_labelled betyr at det er labler til alle eller noe verdier i variabelen.</dbl></p>
<p>En tilsvarende variant er å bruke <em>glimpse()</em> bare på et utvalg variable på tilsvarende måte. Her er et eksempel, men der vi ser på de 10 første variablene.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(norlag[, <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 33,084
Columns: 20
$ ref_nr          &lt;dbl&gt; 5, 5, 5, 10, 10, 10, 12, 12, 12, 15, 15, 15, 18, 18, 1…
$ round           &lt;dbl&gt; 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, …
$ iointervjumnd   &lt;dbl+lbl&gt;      5,     11, 999999,      5,      5,      5,   …
$ iointervjuyr    &lt;dbl+lbl&gt;   2002,   2007, 999999,   2002,   2007,   2017,   …
$ ioalder         &lt;dbl+lbl&gt;     68,     72, 999999,     44,     49,     59,   …
$ iolandb         &lt;dbl+lbl&gt;      1,      1,      1,      1,      1,      1,   …
$ iolandb3        &lt;dbl+lbl&gt;     NA,     NA, 999999,      1,      1,      1,   …
$ iosvar          &lt;dbl+lbl&gt;      1,      1, 999999,      1,      1,      1,   …
$ iofodselsyr     &lt;dbl&gt; 1934, 1934, 1934, 1957, 1957, 1957, 1955, 1955, 1955, …
$ iokjonn         &lt;dbl+lbl&gt; 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1,…
$ iopafyll        &lt;dbl+lbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 0, 0,…
$ iodeltagelse    &lt;dbl+lbl&gt; 5, 5, 5, 1, 1, 1, 2, 2, 2, 5, 5, 5, 3, 3, 3, 4, 4,…
$ ionorlag1kohort &lt;dbl+lbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1,…
$ iododyr         &lt;dbl+lbl&gt; 9996, 9996, 9996, 9996, 9996, 9996, 9996, 9996, 99…
$ ssIO_sivil      &lt;dbl+lbl&gt;  2,  2, NA,  4,  4,  4,  2, NA,  2,  4,  4, NA, NA…
$ hh001c          &lt;dbl+lbl&gt;      1,      1, 999999,      1,      1,      1,   …
$ hh002           &lt;dbl&gt; 2, 2, 999999, 3, 2, 2, 2, 999999, 2, 1, 1, 999999, 999…
$ pa001c          &lt;dbl+lbl&gt;      1,      1, 999999,      0,      1,      1,   …
$ pa002c          &lt;dbl+lbl&gt;     NA,      1, 999999,     NA,      2,      2,   …
$ pa003           &lt;dbl+lbl&gt;     60,     66, 999999,    996,     57,     67,   …</code></pre>
</div>
</div>
<p>I denne output’en er den første kollonnen altså variabelnavnene, deretter er det en kollonne som viser hva slags type variabel det er, og deretter de første observasjonene på hver variabel slik at man får et inntrykk av hvordan det ser ut. <em>glimpse()</em> gir altså omtrent samme informasjon som <em>head()</em>, men er nok mer hensiktsmessig hvis mange variable.</p>
<p>For å se nærmere på en variabel går an å bruke funksjonen <em>look_for()</em>, som primært er en søke-funksjon, men det gir også informasjon om variabelen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">look_for</span>(norlag, <span class="st">"iokjonn"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> pos variable label     col_type values    
 10  iokjonn  IOs kjønn dbl+lbl  [1] Mann  
                                 [2] Kvinne</code></pre>
</div>
</div>
<p>I output fremgår det at dette er den 10’ende variabelen, inneholder informasjonen “IOs kjønn”, er av typen numerisk med tilhørende labler, og verdiene er 1 = Mann og 2 = Kvinne.</p>
<p>Det går også an å bare få ut variabel-label med funksjonen <strong>var_label()</strong> slik:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var_label</span>(norlag<span class="sc">$</span>iokjonn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "IOs kjønn"</code></pre>
</div>
</div>
<p>For å se labels på <em>verdiene</em> bruk <strong>val_labels()</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">val_labels</span>(norlag<span class="sc">$</span>iokjonn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Mann Kvinne 
     1      2 </code></pre>
</div>
</div>
<section id="alternativ-pakken-memisc-og-codebook" class="level3" data-number="1.5.1">
<h3 data-number="1.5.1" class="anchored" data-anchor-id="alternativ-pakken-memisc-og-codebook"><span class="header-section-number">1.5.1</span> Alternativ: pakken {memisc} og <em>codebook()</em></h3>
<p>Man vil klare seg greit med det vi har vist ovenfor. Men det finnes flere måter å gjøre det på. Pakken {memisc} inneholder en rekke funksjoner for å håndtere surveydata, som vi ikke skal gå nærmere inn på her. Men akkurat funksjonen <em>codebook()</em> gir litt mer informativt output enn <em>look_for()</em>.</p>
<p>For å bruke denne må du installere pakken først. I eksempelet nedenfor er pakken ikke lastet med library(), men angitt pakken direkte med memisc:: først. Dette kan være nyttig hvis man ikke skal bruke noen andre funksjoner fra denne pakken.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>memisc<span class="sc">::</span><span class="fu">codebook</span>(norlag<span class="sc">$</span>iokjonn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================

   norlag$iokjonn 'IOs kjønn'

--------------------------------------------------------------------------------

   Storage mode: double
   Measurement: undefined

   Values and labels       N Percent
                                    
   1 'Mann'            16197    49.0
   2 'Kvinne'          16887    51.0</code></pre>
</div>
</div>
<p>Poenget her er altså bare å få en penere output og litt deskriptiv statistikk samtidig.</p>
</section>
</section>
<section id="søke-i-datasettet-etter-variable" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="søke-i-datasettet-etter-variable"><span class="header-section-number">1.6</span> Søke i datasettet etter variable</h2>
<p>Alle datasett skal komme med en dokumentasjon som sier hva hver variabel inneholder og hvilke verdier som finnes i hver variable, og hva de betyr. Dette leveres gjerne som en separat fil, ganske ofte i pdf eller html format. NSD/Sikt leverer dokumentasjonen for Norlag i html-format. (Ideelt burde det vært i et enkelt maskinlesbart format egnet til å bruke til omkoding og labler for de som ønsker det, men de har valgt en annen løsning).</p>
<p>Du kan søke i dokumentasjonen på samme måte som i andre filer, men det kan være litt knotete. Et godt alternativ er å søke direkte i datasettet. Funksjonen <strong>look_for()</strong> søker både i variabelnavn, verdier og labler. Her er et eksempel for hvordan finne variabler som inneholder ordet “yrkesinntekt”. Du kan også søke på kortere eller lengre tekststrenger. (Søker du f.eks. bare på “innt” eller “yrke” så får du opp langt flere variable, så du må kanskje prøve deg litt frem).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">look_for</span>(norlag, <span class="st">"Yrkesinntekt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> pos variable       label                   col_type values                 
 353 inwyrkinnt     Yrkesinntekter NorLAG ~ dbl+lbl  [-5000] Value &lt;0 &gt;-5000
                                                     [5000] Value &gt;0 &lt;5000  
                                                     [999999999] Mangler da~
 371 inpartwyrkinnt Partner: yrkesinntekte~ dbl+lbl  [99999996] Filter: IO ~
                                                     [99999999] Mangler data
                                                     [999999999] Deltok ikk~</code></pre>
</div>
</div>
<p>Det er to variable som inneholder teksten “yrkesinntekt”. Den første variabelen har posisjon 353 i datasettet og har variabelnavnet inwyrkinnt. Den andre variabelen har posisjon 371 og har navnet inpartwyrkinnt. Vi fokuserer på den første.</p>
<p>Merk at når labelen avsluttes med ~ (uttales “tilde”) indikerer det at teksten er avkortet i outputvinduet. Du får opp hele teksten ved å bruke <em>val_label()</em> slik:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var_label</span>(norlag<span class="sc">$</span>inwyrkinnt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Yrkesinntekter NorLAG longitudinell"</code></pre>
</div>
</div>
</section>
<section id="omkode-variable-som-er-labelled" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="omkode-variable-som-er-labelled"><span class="header-section-number">1.7</span> Omkode variable som er labelled</h2>
<p>Noen ganger vil vi omkode en variabel. Et eksempel er variabelen he104. Her er innholdet i den variabelen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>memisc<span class="sc">::</span><span class="fu">codebook</span>(norlag<span class="sc">$</span>he104)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================

   norlag$he104 'Hvordan vil du beskrive din økonomiske situasjon nå'

--------------------------------------------------------------------------------

   Storage mode: double
   Measurement: undefined

   Values and labels                                           N Percent
                                                                        
        1 'Veldig romslig'                                  1425     4.3
        2 'Romslig'                                         8039    24.3
        3 'Må være forsiktig, men klarer meg'               5152    15.6
        4 'Problemer med å få pengene til å strekke til'     551     1.7
        5 'Svært vanskelig økonomisk situasjon'              164     0.5
      999 'Mangler data'                                     403     1.2
    99999 'Ikke svart post/web-skjema'                      5158    15.6
   999999 'Deltok ikke i runden'                           12192    36.9</code></pre>
</div>
</div>
<p>Legg merke til at de tre nederste verdiene egentlig er varianter av å mangle data. Disse verdiene skal normalt ikke være med i en videre analyse, men er “missing”. Vi bør fortelle R at disse verdiene ikke skal tas med videre ved å omkode til NA.</p>
<p>Følgende kode gjør en omkoding til NA. I eksempelet har jeg lagt inn linjeskift for mutate() for å tydeliggjøre de ulike delene.</p>
<ul>
<li>Første linje lager en ny variabel he104b som skal inne en kopi av he104. Funksjonen <em>replace()</em> tar så utgangspunkt i variabelen he104, og de verdiene som ikke er angitt at skal byttes ut vil beholdes fra denne.<br>
</li>
<li>Andre linje sier at hvis variabelen he104 er en av verdiene 999, 99999, eller 999999, så…</li>
<li>sier tredje linje at da skal de få verdien NA i stedet.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>norlag <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">he104b =</span> <span class="fu">replace</span>(he104, </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                         he104 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">999</span>, <span class="dv">99999</span>, <span class="dv">999999</span>), </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                         <span class="cn">NA</span>)) <span class="sc">%&gt;%</span>  </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(he104b) <span class="sc">%&gt;%</span> </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  memisc<span class="sc">::</span><span class="fu">codebook</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================

   he104b 'Hvordan vil du beskrive din økonomiske situasjon nå'

--------------------------------------------------------------------------------

   Storage mode: double
   Measurement: undefined

   Values and labels                                           N Valid Total
                                                                            
        1   'Veldig romslig'                                1425   9.3   4.3
        2   'Romslig'                                       8039  52.4  24.3
        3   'Må være forsiktig, men klarer meg'             5152  33.6  15.6
        4   'Problemer med å få pengene til å strekke til'   551   3.6   1.7
        5   'Svært vanskelig økonomisk situasjon'            164   1.1   0.5
      999   'Mangler data'                                     0   0.0   0.0
    99999   'Ikke svart post/web-skjema'                       0   0.0   0.0
   999999   'Deltok ikke i runden'                             0   0.0   0.0
       NA M                                                17753        53.7</code></pre>
</div>
</div>
<p>Legg merke til at output nå har de omtalte verdiene 0 observasjoner, men lablene finnes i variabelen likevel! Lablene eksisterer altså uavhengig av verdiene i variabelen, men det har kommet en linje til med verdien NA. Det er det det ble omkodet til. Nå trenger vi jo ikke de lablene vi omkodet, så de kan fjernes helt. Funksjoen <em>drop_unused_value_labels()</em> gjør akkurat det det høres ut som. Her er et eksempel:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>norlag <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(he104) <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">he104 =</span> <span class="fu">replace</span>(he104, </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                         he104 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">999</span>, <span class="dv">99999</span>, <span class="dv">999999</span>), </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                         <span class="cn">NA</span>)) <span class="sc">%&gt;%</span>  </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_unused_value_labels</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  memisc<span class="sc">::</span><span class="fu">codebook</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================

   he104 'Hvordan vil du beskrive din økonomiske situasjon nå'

--------------------------------------------------------------------------------

   Storage mode: double
   Measurement: undefined

   Values and labels                                       N Valid Total
                                                                        
    1   'Veldig romslig'                                1425   9.3   4.3
    2   'Romslig'                                       8039  52.4  24.3
    3   'Må være forsiktig, men klarer meg'             5152  33.6  15.6
    4   'Problemer med å få pengene til å strekke til'   551   3.6   1.7
    5   'Svært vanskelig økonomisk situasjon'            164   1.1   0.5
   NA M                                                17753        53.7</code></pre>
</div>
</div>
<section id="alternativ-legg-til-user-specified-na" class="level3" data-number="1.7.1">
<h3 data-number="1.7.1" class="anchored" data-anchor-id="alternativ-legg-til-user-specified-na"><span class="header-section-number">1.7.1</span> Alternativ: legg til user-specified-na</h3>
<p>En alternativ fremgangsmåte er mer slik man ville gjort i annen software ved at man definerer disse verdiene som “missing”, dvs NA. Funksjonen <em>set_na_values()</em> definerer hvilke verdier som skal regnes som NA, men uten å endre lablene eller kode om på annen måte.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>norlag <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(he104) <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_na_values</span>(<span class="at">he104 =</span> <span class="fu">c</span>(<span class="dv">999</span>, <span class="dv">99999</span>, <span class="dv">999999</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  memisc<span class="sc">::</span><span class="fu">codebook</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================

   he104 'Hvordan vil du beskrive din økonomiske situasjon nå'

--------------------------------------------------------------------------------

   Storage mode: double
   Measurement: undefined
   Missing values: 999, 99999, 999999

   Values and labels                                           N Valid Total
                                                                            
        1   'Veldig romslig'                                1425   9.3   4.3
        2   'Romslig'                                       8039  52.4  24.3
        3   'Må være forsiktig, men klarer meg'             5152  33.6  15.6
        4   'Problemer med å få pengene til å strekke til'   551   3.6   1.7
        5   'Svært vanskelig økonomisk situasjon'            164   1.1   0.5
      999 M 'Mangler data'                                   403         1.2
    99999 M 'Ikke svart post/web-skjema'                    5158        15.6
   999999 M 'Deltok ikke i runden'                         12192        36.9</code></pre>
</div>
</div>
<p>I output står det nå en “M” mellom verdien og labelen, som angir at dette er “Missing”. I frekvenstabellen er det nå i prosentueringen skilt mellom <em>Valid</em> og <em>Total</em>, der missing altså ikke er regnet med blant gyldige verdier.</p>
<p>Men det er ryddigst å fjerne disse missing-verdiene og sette de til NA. Funksjonen <em>zap_na()</em> gjør disse verdiene om til NA, altså omkoder alle missingverdiene til NA. Som i forrige variant vil da lablene fremdeles eksistere, men disse kan fjernes på samme måte med <em>drop_unused_value_labels()</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>norlag <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(he104) <span class="sc">%&gt;%</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_na_values</span>(<span class="at">he104 =</span> <span class="fu">c</span>(<span class="dv">999</span>, <span class="dv">99999</span>, <span class="dv">999999</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">zap_missing</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_unused_value_labels</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  memisc<span class="sc">::</span><span class="fu">codebook</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================

   he104 'Hvordan vil du beskrive din økonomiske situasjon nå'

--------------------------------------------------------------------------------

   Storage mode: double
   Measurement: undefined

   Values and labels                                       N Valid Total
                                                                        
    1   'Veldig romslig'                                1425   9.3   4.3
    2   'Romslig'                                       8039  52.4  24.3
    3   'Må være forsiktig, men klarer meg'             5152  33.6  15.6
    4   'Problemer med å få pengene til å strekke til'   551   3.6   1.7
    5   'Svært vanskelig økonomisk situasjon'            164   1.1   0.5
   NA M                                                17753        53.7</code></pre>
</div>
</div>
</section>
</section>
<section id="omkoding-av-andre-verdier" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="omkoding-av-andre-verdier"><span class="header-section-number">1.8</span> Omkoding av andre verdier</h2>
<p>Vi starter med å lagre de endringene som ble testet ut over, og lagrer disse i et nytt datasett som kalles <em>norlag2</em> som vi bruker videre i eksemplene.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>norlag2 <span class="ot">&lt;-</span> norlag <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(he104) <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">he104 =</span> <span class="fu">replace</span>(he104, </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                         he104 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">999</span>, <span class="dv">99999</span>, <span class="dv">999999</span>), </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>                         <span class="cn">NA</span>)) <span class="sc">%&gt;%</span>  </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_unused_value_labels</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La oss si at vi det er mindre viktig om man har det romslig eller veldig romslig. Det er heller ikke så viktig å skille mellom de som ‘problemer’ og de som har det ‘svært vanskelig’. Da ønsker vi å slå sammen disse kategoriene.</p>
<p>For å omkode en variabel som har labler kan vi bruke <strong>recode()</strong>. Det gjør vi typisk innenfor en mutate-setning.</p>
<ul>
<li>Første linje sier at det skal lages en ny variabel, som er en rekodet variant av he104</li>
<li>Andre linje sier at alle med verdien 1 skal gjøres om til verdien 2</li>
<li>Tredje linje sier at alle med verdien 5 skal gjøres om til verdien 4</li>
</ul>
<p>Legg merke til at den opprinneligve verdien angis innenfor apostrof <code>1</code>, mens den nye verdien ikke skal angis med apostrof.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>norlag2 <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">okonomi =</span> <span class="fu">recode</span>(he104, </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">2</span> ,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">5</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">4</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(okonomi) <span class="sc">%&gt;%</span> </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  memisc<span class="sc">::</span><span class="fu">codebook</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================

   okonomi 'Hvordan vil du beskrive din økonomiske situasjon nå'

--------------------------------------------------------------------------------

   Storage mode: double
   Measurement: undefined

   Values and labels                                       N Valid Total
                                                                        
    1   'Veldig romslig'                                   0   0.0   0.0
    2   'Romslig'                                       9464  61.7  28.6
    3   'Må være forsiktig, men klarer meg'             5152  33.6  15.6
    4   'Problemer med å få pengene til å strekke til'   715   4.7   2.2
    5   'Svært vanskelig økonomisk situasjon'              0   0.0   0.0
   NA M                                                17753        53.7</code></pre>
</div>
</div>
<p>Legg merke til at de opprinnelge lablene fremdeles er der, men to av kategoriene har nå null observasjoner. Det innebærer jo også at lablene er litt misvisende, for det er jo egentlig kombinasjoner.</p>
<p>Å omkode lablene kan også gjøres. Funksjonen <em>add_value_labels()</em> angir hvilken variabel lablene skal angis for, og så settes ny label og hvilken verdi det tilsvarer. Lablene for verdier som ikke er nevnt blir beholdt slik de er.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>norlag2 <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">he104 =</span> <span class="fu">recode</span>(he104, </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">2</span> ,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">5</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">4</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.combine_value_labels =</span> <span class="cn">TRUE</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(he104) <span class="sc">%&gt;%</span> </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_value_labels</span>(<span class="at">he104 =</span> <span class="fu">c</span>(<span class="st">"Romslig/veldig romslig"</span> <span class="ot">=</span> <span class="dv">2</span>, </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"Problemer/store problemer"</span> <span class="ot">=</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  memisc<span class="sc">::</span><span class="fu">codebook</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================

   he104 'Hvordan vil du beskrive din økonomiske situasjon nå'

--------------------------------------------------------------------------------

   Storage mode: double
   Measurement: undefined

   Values and labels                            N Valid Total
                                                             
    2   'Romslig/veldig romslig'             9464  61.7  28.6
    3   'Må være forsiktig, men klarer meg'  5152  33.6  15.6
    4   'Problemer/store problemer'           715   4.7   2.2
   NA M                                     17753        53.7</code></pre>
</div>
</div>
</section>
<section id="konverter-variable-til-et-mer-ordinært-r-format" class="level2" data-number="1.9">
<h2 data-number="1.9" class="anchored" data-anchor-id="konverter-variable-til-et-mer-ordinært-r-format"><span class="header-section-number">1.9</span> Konverter variable til et mer ordinært R-format</h2>
<p>Vi starter med å lagre en kopi av datasettet med endrede labler.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>norlag3 <span class="ot">&lt;-</span> norlag2 <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">he104 =</span> <span class="fu">recode</span>(he104, </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">2</span> ,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">5</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">4</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.combine_value_labels =</span> <span class="cn">TRUE</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_value_labels</span>(<span class="at">he104 =</span> <span class="fu">c</span>(<span class="st">"Romslig/veldig romslig"</span> <span class="ot">=</span> <span class="dv">2</span>, </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"Problemer/store problemer"</span> <span class="ot">=</span> <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Men hva skjer når vi skal lage en fin tabell? Vi prøver med {gtsummary} og <em>tbl_summary()</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>norlag3 <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_summary</span>(<span class="at">include =</span> he104)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="axracgiejx" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

:where(#axracgiejx) .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

:where(#axracgiejx) .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#axracgiejx) .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

:where(#axracgiejx) .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

:where(#axracgiejx) .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

:where(#axracgiejx) .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#axracgiejx) .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#axracgiejx) .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

:where(#axracgiejx) .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

:where(#axracgiejx) .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

:where(#axracgiejx) .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

:where(#axracgiejx) .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

:where(#axracgiejx) .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

:where(#axracgiejx) .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

:where(#axracgiejx) .gt_from_md > :first-child {
  margin-top: 0;
}

:where(#axracgiejx) .gt_from_md > :last-child {
  margin-bottom: 0;
}

:where(#axracgiejx) .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

:where(#axracgiejx) .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#axracgiejx) .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

:where(#axracgiejx) .gt_row_group_first td {
  border-top-width: 2px;
}

:where(#axracgiejx) .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#axracgiejx) .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

:where(#axracgiejx) .gt_first_summary_row.thick {
  border-top-width: 2px;
}

:where(#axracgiejx) .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#axracgiejx) .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#axracgiejx) .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

:where(#axracgiejx) .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

:where(#axracgiejx) .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#axracgiejx) .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#axracgiejx) .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#axracgiejx) .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#axracgiejx) .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#axracgiejx) .gt_left {
  text-align: left;
}

:where(#axracgiejx) .gt_center {
  text-align: center;
}

:where(#axracgiejx) .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

:where(#axracgiejx) .gt_font_normal {
  font-weight: normal;
}

:where(#axracgiejx) .gt_font_bold {
  font-weight: bold;
}

:where(#axracgiejx) .gt_font_italic {
  font-style: italic;
}

:where(#axracgiejx) .gt_super {
  font-size: 65%;
}

:where(#axracgiejx) .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

:where(#axracgiejx) .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

:where(#axracgiejx) .gt_indent_1 {
  text-indent: 5px;
}

:where(#axracgiejx) .gt_indent_2 {
  text-indent: 10px;
}

:where(#axracgiejx) .gt_indent_3 {
  text-indent: 15px;
}

:where(#axracgiejx) .gt_indent_4 {
  text-indent: 20px;
}

:where(#axracgiejx) .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>N = 33,084</strong><sup class=&quot;gt_footnote_marks&quot;>1</sup>"><strong>N = 33,084</strong><sup class="gt_footnote_marks">1</sup></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">Hvordan vil du beskrive din økonomiske situasjon nå</td>
<td headers="stat_0" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;2</td>
<td headers="stat_0" class="gt_row gt_center">9,464 (62%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;3</td>
<td headers="stat_0" class="gt_row gt_center">5,152 (34%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;4</td>
<td headers="stat_0" class="gt_row gt_center">715 (4.7%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td headers="stat_0" class="gt_row gt_center">17,753</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="2"><sup class="gt_footnote_marks">1</sup> n (%)</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<p>Tabellen vises altså uten lablene! Noe av poenget med å ha labler var jo å at det skal syens… Siden mange funksjoner i R i utgangspunktet ikke er laget for labler er det rett og slett ikke støttet.</p>
<p>Men vi kan gjøre om variabelen med <em>as_factor()</em>. Gjør om lablene til faktor-nivåer og så lage en tabell med den endrede variabelen. (OBS! funskjonen <em>as.factor()</em> gjør bare nesten det samme. <em>as_factor()</em> er laget bl.a. for å håndtere labler, mens <em>as.factor()</em> ikke gjør det).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>norlag3 <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">he104 =</span> <span class="fu">as_factor</span>(he104)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  gtsummary<span class="sc">::</span><span class="fu">tbl_summary</span>(<span class="at">include =</span> he104)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="hkibcqmvhd" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

:where(#hkibcqmvhd) .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

:where(#hkibcqmvhd) .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#hkibcqmvhd) .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

:where(#hkibcqmvhd) .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

:where(#hkibcqmvhd) .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

:where(#hkibcqmvhd) .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#hkibcqmvhd) .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#hkibcqmvhd) .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

:where(#hkibcqmvhd) .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

:where(#hkibcqmvhd) .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

:where(#hkibcqmvhd) .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

:where(#hkibcqmvhd) .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

:where(#hkibcqmvhd) .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

:where(#hkibcqmvhd) .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

:where(#hkibcqmvhd) .gt_from_md > :first-child {
  margin-top: 0;
}

:where(#hkibcqmvhd) .gt_from_md > :last-child {
  margin-bottom: 0;
}

:where(#hkibcqmvhd) .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

:where(#hkibcqmvhd) .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#hkibcqmvhd) .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

:where(#hkibcqmvhd) .gt_row_group_first td {
  border-top-width: 2px;
}

:where(#hkibcqmvhd) .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#hkibcqmvhd) .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

:where(#hkibcqmvhd) .gt_first_summary_row.thick {
  border-top-width: 2px;
}

:where(#hkibcqmvhd) .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#hkibcqmvhd) .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#hkibcqmvhd) .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

:where(#hkibcqmvhd) .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

:where(#hkibcqmvhd) .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#hkibcqmvhd) .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#hkibcqmvhd) .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#hkibcqmvhd) .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#hkibcqmvhd) .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#hkibcqmvhd) .gt_left {
  text-align: left;
}

:where(#hkibcqmvhd) .gt_center {
  text-align: center;
}

:where(#hkibcqmvhd) .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

:where(#hkibcqmvhd) .gt_font_normal {
  font-weight: normal;
}

:where(#hkibcqmvhd) .gt_font_bold {
  font-weight: bold;
}

:where(#hkibcqmvhd) .gt_font_italic {
  font-style: italic;
}

:where(#hkibcqmvhd) .gt_super {
  font-size: 65%;
}

:where(#hkibcqmvhd) .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

:where(#hkibcqmvhd) .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

:where(#hkibcqmvhd) .gt_indent_1 {
  text-indent: 5px;
}

:where(#hkibcqmvhd) .gt_indent_2 {
  text-indent: 10px;
}

:where(#hkibcqmvhd) .gt_indent_3 {
  text-indent: 15px;
}

:where(#hkibcqmvhd) .gt_indent_4 {
  text-indent: 20px;
}

:where(#hkibcqmvhd) .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>N = 33,084</strong><sup class=&quot;gt_footnote_marks&quot;>1</sup>"><strong>N = 33,084</strong><sup class="gt_footnote_marks">1</sup></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">Hvordan vil du beskrive din økonomiske situasjon nå</td>
<td headers="stat_0" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Romslig/veldig romslig</td>
<td headers="stat_0" class="gt_row gt_center">9,464 (62%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Må være forsiktig, men klarer meg</td>
<td headers="stat_0" class="gt_row gt_center">5,152 (34%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Problemer/store problemer</td>
<td headers="stat_0" class="gt_row gt_center">715 (4.7%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td headers="stat_0" class="gt_row gt_center">17,753</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="2"><sup class="gt_footnote_marks">1</sup> n (%)</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
</section>
<section id="hvordan-gjøre-alt-i-en-fei-alle-variable-samtidig" class="level2" data-number="1.10">
<h2 data-number="1.10" class="anchored" data-anchor-id="hvordan-gjøre-alt-i-en-fei-alle-variable-samtidig"><span class="header-section-number">1.10</span> Hvordan gjøre alt i en fei: alle variable samtidig</h2>
<p>For NorLAG er det noen missingverdier som er definert på tvers av hele datasettet. Se dokumentasjon her: https://norlag.nsd.no/filterverdier Å gjøre de operasjonene vi gjorde over for hver enkelt av de over 400 variablene er utrolig arbeidskrevende og drit kjedelig. Så det gidder vi ikke. Men å omkode alle variable i et helt datasett krever litt mer avanserte operasjoner. Her bruker vi <em>across()</em> som angir at vi skal gjøre samme operasjon på de nærere angitte variablene. Vi kan enten gi en liste med variabelnavn, eller sette et krav om at variablene skal være av en viss type, starte med visse bokstaver eller tegn osv. I eksempelet nedenfor angir vi bare at variabelene skal være av typen ‘labelled’, noe de aller fleste er. Missing-verdiene i datasettet er jo felles for alle variable, så da kan vi bruke replace() og sette disse til NA. Her er et eksempel:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>norlag4 <span class="ot">&lt;-</span> norlag <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>( <span class="fu">where</span>(is.labelled) ,  <span class="sc">~</span><span class="fu">replace</span>(., </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                                        . <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">997</span>, <span class="dv">998</span>, <span class="dv">999</span>, <span class="dv">99999</span>, <span class="dv">999999</span>), </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="cn">NA</span>))) <span class="sc">%&gt;%</span>  </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_unused_value_labels</span>()                                           </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I mutate-setningen skjer følgende:</p>
<ul>
<li>across() sier at vi skal gjøre det samme for flere variable, spesifisert med <em>where(is.labelled)</em>.</li>
<li>for disse skal vi bruke replace(), angitt ved ~replace()</li>
<li>inni parentesen angis . som hver av de variablene som er plukket ut i across(). Så for disse variablene skal det byttes ut verdier</li>
<li>neste linje starter med ., som igjen henviser til de samme variablen, og hvis de har en av de opplistede verdiene</li>
<li>i så fall får de ny verdi NA</li>
</ul>
<p>Dermed er samtlige labelled-variable omkodet på denne måten i en fei.</p>
<p>Da kan vi lage en tabell på nytt. Her får vi samme problem med at lablene ikke synes, men missing-verdiene er i hvetr fall ryddet opp i.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>norlag4 <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  gtsummary<span class="sc">::</span><span class="fu">tbl_summary</span>(<span class="at">include =</span> he104)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="csorshyucb" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

:where(#csorshyucb) .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

:where(#csorshyucb) .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#csorshyucb) .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

:where(#csorshyucb) .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

:where(#csorshyucb) .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

:where(#csorshyucb) .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#csorshyucb) .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#csorshyucb) .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

:where(#csorshyucb) .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

:where(#csorshyucb) .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

:where(#csorshyucb) .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

:where(#csorshyucb) .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

:where(#csorshyucb) .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

:where(#csorshyucb) .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

:where(#csorshyucb) .gt_from_md > :first-child {
  margin-top: 0;
}

:where(#csorshyucb) .gt_from_md > :last-child {
  margin-bottom: 0;
}

:where(#csorshyucb) .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

:where(#csorshyucb) .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#csorshyucb) .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

:where(#csorshyucb) .gt_row_group_first td {
  border-top-width: 2px;
}

:where(#csorshyucb) .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#csorshyucb) .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

:where(#csorshyucb) .gt_first_summary_row.thick {
  border-top-width: 2px;
}

:where(#csorshyucb) .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#csorshyucb) .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#csorshyucb) .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

:where(#csorshyucb) .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

:where(#csorshyucb) .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#csorshyucb) .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#csorshyucb) .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#csorshyucb) .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#csorshyucb) .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#csorshyucb) .gt_left {
  text-align: left;
}

:where(#csorshyucb) .gt_center {
  text-align: center;
}

:where(#csorshyucb) .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

:where(#csorshyucb) .gt_font_normal {
  font-weight: normal;
}

:where(#csorshyucb) .gt_font_bold {
  font-weight: bold;
}

:where(#csorshyucb) .gt_font_italic {
  font-style: italic;
}

:where(#csorshyucb) .gt_super {
  font-size: 65%;
}

:where(#csorshyucb) .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

:where(#csorshyucb) .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

:where(#csorshyucb) .gt_indent_1 {
  text-indent: 5px;
}

:where(#csorshyucb) .gt_indent_2 {
  text-indent: 10px;
}

:where(#csorshyucb) .gt_indent_3 {
  text-indent: 15px;
}

:where(#csorshyucb) .gt_indent_4 {
  text-indent: 20px;
}

:where(#csorshyucb) .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>N = 33,084</strong><sup class=&quot;gt_footnote_marks&quot;>1</sup>"><strong>N = 33,084</strong><sup class="gt_footnote_marks">1</sup></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">Hvordan vil du beskrive din økonomiske situasjon nå</td>
<td headers="stat_0" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;1</td>
<td headers="stat_0" class="gt_row gt_center">1,425 (9.3%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;2</td>
<td headers="stat_0" class="gt_row gt_center">8,039 (52%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;3</td>
<td headers="stat_0" class="gt_row gt_center">5,152 (34%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;4</td>
<td headers="stat_0" class="gt_row gt_center">551 (3.6%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;5</td>
<td headers="stat_0" class="gt_row gt_center">164 (1.1%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td headers="stat_0" class="gt_row gt_center">17,753</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="2"><sup class="gt_footnote_marks">1</sup> n (%)</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<p>Vi kan selvfølgelig endre til factor som gjort over, men da får vi igjen et problem med å gjøre det en variabel om gangen. Igjen: det gidder vi ikke. I stedet bruker vi en enkel funksjon som fikser biffen for hele datasettet, nemlig <em>unlabelled()</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>norlag4 <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlabelled</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  gtsummary<span class="sc">::</span><span class="fu">tbl_summary</span>(<span class="at">include =</span> he104)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="xoqzhiogbc" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

:where(#xoqzhiogbc) .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

:where(#xoqzhiogbc) .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#xoqzhiogbc) .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

:where(#xoqzhiogbc) .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

:where(#xoqzhiogbc) .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

:where(#xoqzhiogbc) .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#xoqzhiogbc) .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#xoqzhiogbc) .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

:where(#xoqzhiogbc) .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

:where(#xoqzhiogbc) .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

:where(#xoqzhiogbc) .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

:where(#xoqzhiogbc) .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

:where(#xoqzhiogbc) .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

:where(#xoqzhiogbc) .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

:where(#xoqzhiogbc) .gt_from_md > :first-child {
  margin-top: 0;
}

:where(#xoqzhiogbc) .gt_from_md > :last-child {
  margin-bottom: 0;
}

:where(#xoqzhiogbc) .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

:where(#xoqzhiogbc) .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#xoqzhiogbc) .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

:where(#xoqzhiogbc) .gt_row_group_first td {
  border-top-width: 2px;
}

:where(#xoqzhiogbc) .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#xoqzhiogbc) .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

:where(#xoqzhiogbc) .gt_first_summary_row.thick {
  border-top-width: 2px;
}

:where(#xoqzhiogbc) .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#xoqzhiogbc) .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#xoqzhiogbc) .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

:where(#xoqzhiogbc) .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

:where(#xoqzhiogbc) .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#xoqzhiogbc) .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#xoqzhiogbc) .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#xoqzhiogbc) .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#xoqzhiogbc) .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#xoqzhiogbc) .gt_left {
  text-align: left;
}

:where(#xoqzhiogbc) .gt_center {
  text-align: center;
}

:where(#xoqzhiogbc) .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

:where(#xoqzhiogbc) .gt_font_normal {
  font-weight: normal;
}

:where(#xoqzhiogbc) .gt_font_bold {
  font-weight: bold;
}

:where(#xoqzhiogbc) .gt_font_italic {
  font-style: italic;
}

:where(#xoqzhiogbc) .gt_super {
  font-size: 65%;
}

:where(#xoqzhiogbc) .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

:where(#xoqzhiogbc) .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

:where(#xoqzhiogbc) .gt_indent_1 {
  text-indent: 5px;
}

:where(#xoqzhiogbc) .gt_indent_2 {
  text-indent: 10px;
}

:where(#xoqzhiogbc) .gt_indent_3 {
  text-indent: 15px;
}

:where(#xoqzhiogbc) .gt_indent_4 {
  text-indent: 20px;
}

:where(#xoqzhiogbc) .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>N = 33,084</strong><sup class=&quot;gt_footnote_marks&quot;>1</sup>"><strong>N = 33,084</strong><sup class="gt_footnote_marks">1</sup></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">Hvordan vil du beskrive din økonomiske situasjon nå</td>
<td headers="stat_0" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Veldig romslig</td>
<td headers="stat_0" class="gt_row gt_center">1,425 (9.3%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Romslig</td>
<td headers="stat_0" class="gt_row gt_center">8,039 (52%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Må være forsiktig, men klarer meg</td>
<td headers="stat_0" class="gt_row gt_center">5,152 (34%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Problemer med å få pengene til å strekke til</td>
<td headers="stat_0" class="gt_row gt_center">551 (3.6%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Svært vanskelig økonomisk situasjon</td>
<td headers="stat_0" class="gt_row gt_center">164 (1.1%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td headers="stat_0" class="gt_row gt_center">17,753</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="2"><sup class="gt_footnote_marks">1</sup> n (%)</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<p>OBS! Unlabelled endrer alle labelled-variablene. Det er ikke sikkert at vi vil det. Spesielt gjelder det at det kan være andre labler knyttet til variable som skal være kontinuerlige. Men: hvis man har gjort en god opprydning i datasetet i forkant, med de omkodinger som trengs (det må nok gjøres en for en variabel), så er dette ganske greit.</p>
<section id="sett-det-hele-sammen-fiks-hele-skiten-i-en-fei" class="level3" data-number="1.10.1">
<h3 data-number="1.10.1" class="anchored" data-anchor-id="sett-det-hele-sammen-fiks-hele-skiten-i-en-fei"><span class="header-section-number">1.10.1</span> Sett det hele sammen: fiks hele skiten i en fei</h3>
<p>Hvert steg ovenfor blir ganske omstendelig, og det ser vanskeligere ut enn det er. Her er en kode som setter det hele sammen i ett steg.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>norlag <span class="ot">&lt;-</span> <span class="fu">read_stata</span>(<span class="st">"data/norlag_panel2022.dta"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>( <span class="fu">where</span>(is.labelled) ,  <span class="sc">~</span><span class="fu">replace</span>(., </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                                        . <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">997</span>, <span class="dv">998</span>, <span class="dv">999</span>, <span class="dv">99999</span>, <span class="dv">999999</span>), </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="cn">NA</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Her kan ymse omkodinger av labeelled data gjøres: </span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">he104 =</span> <span class="fu">recode</span>(he104, </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">2</span> ,</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">5</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">4</span>,</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.combine_value_labels =</span> <span class="cn">TRUE</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Her kan endrer du lablene hvis det trengs for de samme variablene: </span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_value_labels</span>(<span class="at">he104 =</span> <span class="fu">c</span>(<span class="st">"Romslig/veldig romslig"</span> <span class="ot">=</span> <span class="dv">2</span>, </span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"Problemer/store problemer"</span> <span class="ot">=</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For hele datasettet fjernes ikke-brukte labler </span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_unused_value_labels</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Så gjør alle variable om til mer ordinære R-format. Dvs. gjøres labler om til factor</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlabelled</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Så kan du gjøre andre analyser etter dette. Hvis du trenger å gå tilbake for å omkode flere labelled-variable, så legges dette til i mutate-setningen over. Det er lurt å gjøre all den typen omkoding ett sted, slik at du får et datasett som er ferdig ryddet og klart til andre analyser.</p>
</section>
</section>
<section id="omkoding-av-factor-variable" class="level2" data-number="1.11">
<h2 data-number="1.11" class="anchored" data-anchor-id="omkoding-av-factor-variable"><span class="header-section-number">1.11</span> Omkoding av factor-variable</h2>
<p>Noen ganger har man et datasett som allerede er omgjort med factor-variable. Eller du har en eller annen grunn til å ikke gå tilbake til et tidligere steg for å omkode. Men du har factor-levels med skikkelig lang tekst kan det være noe drit å kode om. Kan man gjøre dette på en lurere måte? Minst mulig tårer? Ja, selvsagt.</p>
<p>I NorLAG er variabelen wr117zz svar på et spørsmål om “Mulighet for å redusert arbeidstid (deltid)”. Når denne variabelen er gjort om til factor kan man se hvilke verdier variabelen har med bruke av funksjonen <em>levels()</em> slik:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(norlag<span class="sc">$</span>wr117zz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Nei"                                                               
[2] "Ja"                                                                
[3] "filter: jobber deltid"                                             
[4] "filter: selvstendig næringsdrivende (NorLAG3 inkl frilanser/annet)"
[5] "filter: ikke i arbeid"                                             </code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(norlag<span class="sc">$</span>wr117zz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                                                               Nei 
                                                              1360 
                                                                Ja 
                                                              4146 
                                             filter: jobber deltid 
                                                              1964 
filter: selvstendig næringsdrivende (NorLAG3 inkl frilanser/annet) 
                                                              1171 
                                             filter: ikke i arbeid 
                                                              6238 </code></pre>
</div>
</div>
<p>La oss si at vi vil kode om slik at vi får en variabel som bare er om vedkommende har mulighet til å jobbe deltid eller ikke. De som allerede jobber deltid har jo åpenbart mulighet til det, så de skal kodes om til “Ja”. De andre kategoriene er egentlig grunner til at det mangler data, så de skal settes til NA. En mulighet er da å omkode som følger:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>norlag_omkodet <span class="ot">&lt;-</span> norlag <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">redarbtid =</span> <span class="fu">replace</span>(wr117zz, wr117zz <span class="sc">==</span> <span class="st">"filter: jobber deltid"</span>, <span class="st">"Ja"</span>), </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">redarbtid =</span> <span class="fu">replace</span>(redarbtid, redarbtid <span class="sc">==</span> <span class="st">"filter: selvstendig næringsdrivende (NorLAG3 inkl frilanser/annet)"</span>, <span class="cn">NA</span>), </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">redarbtid =</span> <span class="fu">replace</span>(redarbtid, redarbtid <span class="sc">==</span> <span class="st">"filter: ikke i arbeid"</span>, <span class="cn">NA</span>), </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">redarbtid =</span> <span class="fu">replace</span>(redarbtid, redarbtid <span class="sc">==</span> <span class="st">"vil ikke svare"</span>, <span class="cn">NA</span>),</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">redarbtid =</span> <span class="fu">replace</span>(redarbtid, redarbtid <span class="sc">==</span> <span class="st">"vet ikke"</span>, <span class="cn">NA</span>),</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">redarbtid =</span> <span class="fu">replace</span>(redarbtid, redarbtid <span class="sc">==</span> <span class="st">"mangler data"</span>, <span class="cn">NA</span>),</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">redarbtid =</span> <span class="fu">replace</span>(redarbtid, redarbtid <span class="sc">==</span> <span class="st">"Deltok ikke i runden"</span>, <span class="cn">NA</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dette funker, men blir ganske mye tekst å skrive, og da kan man også lett gjøre skrivefeil. Husk at faktornivåene må angis helt nøyaktig slik de er skrevet! Merk at den siste funksjone, <em>droplevels()</em>, bare fjerner faktor-levels som ikke er i bruk.</p>
<p>I output for faktor-levels angir klammeparentesen gir rekkefølgen på disse verdiene. Vi kan bruke denne informasjonen direkte i omkodingen for å unngå å skrive så veldig mye. Når man bruker levels() får man en liten vektor med verdier, og disse kan man altså henvise til med rekkefølgen. Her er et eksempel for bare å bytte ut de som jobber deltid til “Ja”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>norlag_omkodet <span class="ot">&lt;-</span> norlag <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">redarbtid =</span> <span class="fu">replace</span>(wr117zz, wr117zz <span class="sc">==</span> <span class="fu">levels</span>(wr117zz)[<span class="dv">3</span>], <span class="st">"Ja"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Trikset her er altså å bruke levels() og vise til hvilket nummer i rekkefølgen. Da unngår vi også faren for skrivefeil.</p>
<p>Vi vil også kode om alle de andre verdiene, nummer 4-9 til NA. Det kan vi gjøre på samme måte, men vi behøver ikke skrive en ny linje for hver verdi. Den logiske operatoren == kan man bruke når man skal sjekke om to verdier er like. Hvis vi skal se om en verdi er lik en av flere mulige kan vi bruke %in% og så en liste med verdier. levels() gir en liste med verdier, så da kan vi angi den direkte og alle verdiene 4 til 9 ved å skrive 4:9. Samlet blir det da slik:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>norlag_omkodet <span class="ot">&lt;-</span> norlag <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">redarbtid =</span> <span class="fu">replace</span>(wr117zz, wr117zz <span class="sc">==</span> <span class="fu">levels</span>(wr117zz)[<span class="dv">3</span>], <span class="st">"Ja"</span>), </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">redarbtid =</span> <span class="fu">replace</span>(redarbtid, redarbtid <span class="sc">%in%</span> <span class="fu">levels</span>(wr117zz)[<span class="dv">4</span><span class="sc">:</span><span class="dv">9</span>], <span class="cn">NA</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>()</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>memisc<span class="sc">::</span><span class="fu">codebook</span>(norlag_omkodet<span class="sc">$</span>redarbtid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================

   norlag_omkodet$redarbtid

--------------------------------------------------------------------------------

   Storage mode: integer
   Factor with 2 levels

   Levels and labels     N Valid Total
                                      
    1 'Nei'           1360  18.2   4.1
    2 'Ja'            6110  81.8  18.5
   NA                25614        77.4</code></pre>
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Forord</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb51" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Håndtering av data med innebygd metadata</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>I dette kapittelet skal vi bruke følgende pakker:</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)       <span class="co"># Importere data fra SAS, SPSS og Stata</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)   <span class="co"># Pakker for generell datahåndtering og grafikk</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(labelled)    <span class="co"># Håndtering av variable med labler, importert fra annen software</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)     <span class="co"># Lettere omkoding av faktorvariable</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="fu">## Intro: Dataformater </span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>Det kan være ulike problemstillinger knyttet til type data, dataformater, men også hvordan noen har valgt å lagre/distribuere data. Det kan være vanskelig å skille mellom disse og man kan noen ganger lure på om det er hos R begrensningene ligger. Det kan være flere av disse, men som hovedregel er problemet at data ofte ikke er distribuert i et universelt format. Permanent lagring og distribusjon av data er krevende, men ikke temaet her. Uansett: du vil ofte få data i et format som ikke er tilrettelagt verken i eller for R. Å gjøre om data fra et format til et annet kan være en avgjørende oppgave for å få gjort noe som helst. </span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>Dette kan være krøkete og du har vikelig muligheten til å kløne det til skikkelig. For at du skal slippe det gir dette kapittelet en oppskrift for å håndtere slike data slik at du kan jobbe videre med dem i R på en hensiktsmessig måte. </span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>Det er også noen utfordringer i R for håndtering av factor-variable med lange (noen ganger veldig lange) 'labler'. Det gis noen løsninger på det også som gjør kodingen håndterbar. </span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a><span class="fu">## Noen dataformater typisk for norske surveydata </span></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>I Norge er Sikt (tidliger NSD) en stor leverandør av data til samfunnsvitenskapen. De leverer ofte data i proprietære formater som SAS, SPSS eller Stata. I tillegg vil de levere en *flat fil* som typisk er *comma separated variables* (csv). I de førstnevnte vil metadata være integrert, mens i csv er det bare kodene og metadata må slås opp i dokumentasjonen. </span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a><span class="fu">## Suveydata med innebygd metadata</span></span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>En type data som er mye brukt i samfunnsvitenskapen er surveydata, altså: data innhentet ved hjelp av spørreskjema. Slike data inneholder gjerne en god del kategoriske data eller man svarer på en likert-skala (f.eks. skala fra 1 til 5), men også kontinuerlige variable og kan også være tekstsvar. </span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a>Slike data er ofte *kodet* slik at bestemte verdier har en tekstlig betydning. F.eks. 1 = "gift" og 2 = "ugift", eller 1 = "veldig fornøyd" og 5 = "veldig misfornøyd" osv. </span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a>I R vil slike variable normalt håndteres som såkalte faktor-variable, men ofte vil surveydata inneholde relativt lange tekstverdier som gjør det tungvint. Men det finnes løsninger. For å gjøre en lang historie kort: Surveydata er best å håndtere med pakkene {labelled}. For videre analyser er det derimot vanligvis best å ha faktor-variable, så vi vil oftest konvertere dataene etterpå. Det høres tungvindt ut, men konverteringen er bare et par linjer kode. </span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a>Et spesielt problem er at i Stata og SPSS vil mange datasett inneholde spesielle verdier som skal tolkes som *manglende data*, såkalt 'missing'. Det kan altså være egne koder for om respondenten ikke fikk stilt spørsmålet, ikke ville svare, eller andre grunner. For en variabel for inntekt kan f.eks. verdien 999999 betyr at vedkommende ikke ville svare. Når vi regner et gjennomsnitt er det da viktig at akkurat disse verdiene ikke inngår i beregningen. (Å kode på denne måten kan si er en uting uansett software, så vi skal i hvert fall kvitte oss med disse). </span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a>I R er det flere pakker og funksjoner som er spesielt egnet til å håndtere slike data og vi skal bruke følgende: </span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb51-45"><a href="#cb51-45" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-46"><a href="#cb51-46" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-47"><a href="#cb51-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)       <span class="co"># For å lese inn data fra SPSS, Stata eller SAS</span></span>
<span id="cb51-48"><a href="#cb51-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(labelled)    <span class="co"># For å håndtere variable og verdier som inneholder 'labler'</span></span>
<span id="cb51-49"><a href="#cb51-49" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-50"><a href="#cb51-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-51"><a href="#cb51-51" aria-hidden="true" tabindex="-1"></a>I tillegg skal vi bruke pakker for generell datahåndtering som er samlet i pakken {tidyverse}, deriblant en pakke {forcats} for håndtering av kategoriske variable. </span>
<span id="cb51-54"><a href="#cb51-54" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-55"><a href="#cb51-55" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-56"><a href="#cb51-56" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-57"><a href="#cb51-57" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)   <span class="co"># Generelle funksjoner for datahåndtering</span></span>
<span id="cb51-58"><a href="#cb51-58" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-59"><a href="#cb51-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-60"><a href="#cb51-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-61"><a href="#cb51-61" aria-hidden="true" tabindex="-1"></a>I det følgende skal vi dekke disse temaene: </span>
<span id="cb51-62"><a href="#cb51-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-63"><a href="#cb51-63" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Hvordan lese inn data fra Stata-formatet</span>
<span id="cb51-64"><a href="#cb51-64" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Hvordan få oversikt over datasettet</span>
<span id="cb51-65"><a href="#cb51-65" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Hvordan omkode variable med 'labler' </span>
<span id="cb51-66"><a href="#cb51-66" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Hvordan håndtere verdier som er kodet som 'missing' i Stata-formatet (kalles user-defined-NA i R) </span>
<span id="cb51-67"><a href="#cb51-67" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Hvordan gjøre om labelled-variable til faktor-variable </span>
<span id="cb51-68"><a href="#cb51-68" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Hvordan gjør det ovenstående på veldig mange variable på en gang (altså: fremfor en og en, så du kan bruke tiden din på morsommere ting)</span>
<span id="cb51-69"><a href="#cb51-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-70"><a href="#cb51-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-71"><a href="#cb51-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-72"><a href="#cb51-72" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lese inn data i Stata-formatet .dta </span></span>
<span id="cb51-73"><a href="#cb51-73" aria-hidden="true" tabindex="-1"></a>I det følgende bruker jeg som eksempel dataene NorLag som man kan få tilgang til via NSD/Sikt her: https://norlag.nsd.no/. Disse dataene kan lastes ned i flere ulike typer formater slik data fra NSD/Sikt gjerne kan. Tilsvarende vil altså gjelde for andre datasett derfra. De ulike dataformatene er typisk tilpasset spesifikke software og det er en utfordring hvis man bruker et annet system enn det NSD har sett for seg. </span>
<span id="cb51-74"><a href="#cb51-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-75"><a href="#cb51-75" aria-hidden="true" tabindex="-1"></a>De leverer også data i csv-format som ikke er uavhengig av software og kan leses inn av alle typer statistikksoftware. Generelt er csv-formatet å foretrekke når man skal dele data nettopp av denne grunn. Det er også et format som ikke er sårbar for endringer i softwaren over lengre tid slik at det må konverteres mellom formatversjoner. Særlig for surveydata er derimot csv-formatet ikke alltid så godt i praksis da det krever en godt opplegg for dokumentasjon og metadata som trengs i kodingen av data. NSD/Sikt har valgt en måte å dokumentere metadata på som ikke er lett håndterbart maskinelt av ikke-profesjonelle programmerere. Dette gjør csv-formatet lite egnet i dette tilfellet. </span>
<span id="cb51-76"><a href="#cb51-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-77"><a href="#cb51-77" aria-hidden="true" tabindex="-1"></a>Derimot kan man laste ned dataene i formatene til SPSS eller Stata. Vi vil her forholde oss kun til Stata-filer, men det vil være tilsvarende med SPSS og i praksis også SAS. Stata-formatet har en filhale som slutter på '.dta'. Fordelen med dette formatet er at metadata er innebygd i selve dataformatet. Altså, at en kategorisk variabel vil inneholde *både* en tallkode og en tekst med informasjon om hva tallet betyr. Dette er imidlertid en måte å håndtere data på som ikke er optimal for R. </span>
<span id="cb51-78"><a href="#cb51-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-79"><a href="#cb51-79" aria-hidden="true" tabindex="-1"></a>I det følgende skal vi dekke </span>
<span id="cb51-80"><a href="#cb51-80" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Lese inn Stata-filer </span>
<span id="cb51-81"><a href="#cb51-81" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Søke etter variable </span>
<span id="cb51-82"><a href="#cb51-82" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Undersøke hvordan variable er kodet, se på 'lablene'</span>
<span id="cb51-83"><a href="#cb51-83" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Gjøre omkodinger av variablene</span>
<span id="cb51-84"><a href="#cb51-84" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Endre variable til faktor-variable </span>
<span id="cb51-85"><a href="#cb51-85" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Omkode faktor-variable med veldig lange tekstverdier </span>
<span id="cb51-86"><a href="#cb51-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-87"><a href="#cb51-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-88"><a href="#cb51-88" aria-hidden="true" tabindex="-1"></a><span class="fu">### Innlesning med {haven}</span></span>
<span id="cb51-89"><a href="#cb51-89" aria-hidden="true" tabindex="-1"></a>Formatene Stata, SPSS og SAS er proprietære og man trenger i utgangspunktet disse softwarene for å åpne datafilene (og betale dyr lisens). For å lese inn i R kan man bruke pakken {haven} som inneholder spesialiserte funksjoner for å lese inn disse formatene. Funskjonen **read_stata()** leser inn dataene på en måte som bevarer særegenhetene fra Stata-formatet. </span>
<span id="cb51-90"><a href="#cb51-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-91"><a href="#cb51-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-92"><a href="#cb51-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-95"><a href="#cb51-95" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-96"><a href="#cb51-96" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-97"><a href="#cb51-97" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-98"><a href="#cb51-98" aria-hidden="true" tabindex="-1"></a>norlag <span class="ot">&lt;-</span> <span class="fu">read_stata</span>(<span class="st">"data/norlag_panel2022.dta"</span>) </span>
<span id="cb51-99"><a href="#cb51-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-100"><a href="#cb51-100" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-101"><a href="#cb51-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-102"><a href="#cb51-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-103"><a href="#cb51-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-104"><a href="#cb51-104" aria-hidden="true" tabindex="-1"></a><span class="fu">## Få oversikt over dataene </span></span>
<span id="cb51-105"><a href="#cb51-105" aria-hidden="true" tabindex="-1"></a>Vi har nå et datasett i minnet og vi bør ta en titt på det. Nå er det mange hundre variable i datasettet, så det er lite hensiktsmessig å printe det til konsollen fordi det er rett og slett ikke plass. I tidligere kurs skal dere ha lært å bruke funksjonen *glimpse()*, men også her blir det mest rotete fordi det er så mange variable. </span>
<span id="cb51-106"><a href="#cb51-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-107"><a href="#cb51-107" aria-hidden="true" tabindex="-1"></a>En enkel løsning er å bare se på noen få variable om gangen. Med klammeparentes kan vi angi hvilke radnummer og kolonnenummer vi ønsker se på med følgende syntax: **datasett[rader, kolonner]** der altså komma skiller mellom rader og kolonner. Følgende eksempel viser hvordan man kan bruke *head()* for å vise de første observasjonene i datasettet med bare de første 5 variablene (altså: kollonne nr 1-5). </span>
<span id="cb51-108"><a href="#cb51-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-111"><a href="#cb51-111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-112"><a href="#cb51-112" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-113"><a href="#cb51-113" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-114"><a href="#cb51-114" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(norlag[, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb51-115"><a href="#cb51-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-116"><a href="#cb51-116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-117"><a href="#cb51-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-118"><a href="#cb51-118" aria-hidden="true" tabindex="-1"></a>Legg merke til at under hvert variabelnavn står det en liten tekst, f.eks. <span class="kw">&lt;dbl&gt;</span> eller <span class="kw">&lt;S3:</span> <span class="er">haven_labelled</span><span class="kw">&gt;</span>. Det kan også stå andre ting. dbl betyr at det er en kontinuerlig variabel, mens haven_labelled betyr at det er labler til alle eller noe verdier i variabelen. </span>
<span id="cb51-119"><a href="#cb51-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-120"><a href="#cb51-120" aria-hidden="true" tabindex="-1"></a>En tilsvarende variant er å bruke *glimpse()* bare på et utvalg variable på tilsvarende måte. Her er et eksempel, men der vi ser på de 10 første variablene. </span>
<span id="cb51-121"><a href="#cb51-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-124"><a href="#cb51-124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-125"><a href="#cb51-125" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-126"><a href="#cb51-126" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-127"><a href="#cb51-127" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(norlag[, <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>])</span>
<span id="cb51-128"><a href="#cb51-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-129"><a href="#cb51-129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-130"><a href="#cb51-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-131"><a href="#cb51-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-132"><a href="#cb51-132" aria-hidden="true" tabindex="-1"></a>I denne output'en er den første kollonnen altså variabelnavnene, deretter er det en kollonne som viser hva slags type variabel det er, og deretter de første observasjonene på hver variabel slik at man får et inntrykk av hvordan det ser ut. *glimpse()* gir altså omtrent samme informasjon som *head()*, men er nok mer hensiktsmessig hvis mange variable. </span>
<span id="cb51-133"><a href="#cb51-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-134"><a href="#cb51-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-135"><a href="#cb51-135" aria-hidden="true" tabindex="-1"></a>For å se nærmere på en variabel går an å bruke funksjonen *look_for()*, som primært er en søke-funksjon, men det gir også informasjon om variabelen.</span>
<span id="cb51-136"><a href="#cb51-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-137"><a href="#cb51-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-140"><a href="#cb51-140" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-141"><a href="#cb51-141" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-142"><a href="#cb51-142" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-143"><a href="#cb51-143" aria-hidden="true" tabindex="-1"></a><span class="fu">look_for</span>(norlag, <span class="st">"iokjonn"</span>)</span>
<span id="cb51-144"><a href="#cb51-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-145"><a href="#cb51-145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-146"><a href="#cb51-146" aria-hidden="true" tabindex="-1"></a>I output fremgår det at dette er den 10'ende variabelen, inneholder informasjonen "IOs kjønn", er av typen numerisk med tilhørende labler, og verdiene er 1 = Mann og 2 = Kvinne. </span>
<span id="cb51-147"><a href="#cb51-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-148"><a href="#cb51-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-149"><a href="#cb51-149" aria-hidden="true" tabindex="-1"></a>Det går også an å bare få ut variabel-label med funksjonen **var_label()** slik: </span>
<span id="cb51-150"><a href="#cb51-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-153"><a href="#cb51-153" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-154"><a href="#cb51-154" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-155"><a href="#cb51-155" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-156"><a href="#cb51-156" aria-hidden="true" tabindex="-1"></a><span class="fu">var_label</span>(norlag<span class="sc">$</span>iokjonn)</span>
<span id="cb51-157"><a href="#cb51-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-158"><a href="#cb51-158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-159"><a href="#cb51-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-160"><a href="#cb51-160" aria-hidden="true" tabindex="-1"></a>For å se labels på *verdiene* bruk **val_labels()**.</span>
<span id="cb51-163"><a href="#cb51-163" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-164"><a href="#cb51-164" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-165"><a href="#cb51-165" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-166"><a href="#cb51-166" aria-hidden="true" tabindex="-1"></a><span class="fu">val_labels</span>(norlag<span class="sc">$</span>iokjonn)</span>
<span id="cb51-167"><a href="#cb51-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-168"><a href="#cb51-168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-169"><a href="#cb51-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-170"><a href="#cb51-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-171"><a href="#cb51-171" aria-hidden="true" tabindex="-1"></a><span class="fu">### Alternativ: pakken {memisc} og *codebook()*</span></span>
<span id="cb51-172"><a href="#cb51-172" aria-hidden="true" tabindex="-1"></a>Man vil klare seg greit med det vi har vist ovenfor. Men det finnes flere måter å gjøre det på. Pakken {memisc} inneholder en rekke funksjoner for å håndtere surveydata, som vi ikke skal gå nærmere inn på her. Men akkurat funksjonen *codebook()* gir litt mer informativt output enn *look_for()*. </span>
<span id="cb51-173"><a href="#cb51-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-174"><a href="#cb51-174" aria-hidden="true" tabindex="-1"></a>For å bruke denne må du installere pakken først. I eksempelet nedenfor er pakken ikke lastet med library(), men angitt pakken direkte med memisc:: først. Dette kan være nyttig hvis man ikke skal bruke noen andre funksjoner fra denne pakken.</span>
<span id="cb51-175"><a href="#cb51-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-178"><a href="#cb51-178" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-179"><a href="#cb51-179" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-180"><a href="#cb51-180" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-181"><a href="#cb51-181" aria-hidden="true" tabindex="-1"></a>memisc<span class="sc">::</span><span class="fu">codebook</span>(norlag<span class="sc">$</span>iokjonn)</span>
<span id="cb51-182"><a href="#cb51-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-183"><a href="#cb51-183" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-184"><a href="#cb51-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-185"><a href="#cb51-185" aria-hidden="true" tabindex="-1"></a>Poenget her er altså bare å få en penere output og litt deskriptiv statistikk samtidig. </span>
<span id="cb51-186"><a href="#cb51-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-187"><a href="#cb51-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-188"><a href="#cb51-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-189"><a href="#cb51-189" aria-hidden="true" tabindex="-1"></a><span class="fu">## Søke i datasettet etter variable</span></span>
<span id="cb51-190"><a href="#cb51-190" aria-hidden="true" tabindex="-1"></a>Alle datasett skal komme med en dokumentasjon som sier hva hver variabel inneholder og hvilke verdier som finnes i hver variable, og hva de betyr. Dette leveres gjerne som en separat fil, ganske ofte i pdf eller html format. NSD/Sikt leverer dokumentasjonen for Norlag i html-format. (Ideelt burde det vært i et enkelt maskinlesbart format egnet til å bruke til omkoding og labler for de som ønsker det, men de har valgt en annen løsning). </span>
<span id="cb51-191"><a href="#cb51-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-192"><a href="#cb51-192" aria-hidden="true" tabindex="-1"></a>Du kan søke i dokumentasjonen på samme måte som i andre filer, men det kan være litt knotete. Et godt alternativ er å søke direkte i datasettet. Funksjonen **look_for()** søker både i variabelnavn, verdier og labler. Her er et eksempel for hvordan finne variabler som inneholder ordet "yrkesinntekt". Du kan også søke på kortere eller lengre tekststrenger. (Søker du f.eks. bare på "innt" eller "yrke" så får du opp langt flere variable, så du må kanskje prøve deg litt frem).</span>
<span id="cb51-193"><a href="#cb51-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-196"><a href="#cb51-196" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-197"><a href="#cb51-197" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-198"><a href="#cb51-198" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-199"><a href="#cb51-199" aria-hidden="true" tabindex="-1"></a><span class="fu">look_for</span>(norlag, <span class="st">"Yrkesinntekt"</span>)</span>
<span id="cb51-200"><a href="#cb51-200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-201"><a href="#cb51-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-202"><a href="#cb51-202" aria-hidden="true" tabindex="-1"></a>Det er to variable som inneholder teksten "yrkesinntekt". Den første variabelen har posisjon 353 i datasettet og har variabelnavnet inwyrkinnt.  Den andre variabelen har posisjon 371 og har navnet inpartwyrkinnt. Vi fokuserer på den første.</span>
<span id="cb51-203"><a href="#cb51-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-204"><a href="#cb51-204" aria-hidden="true" tabindex="-1"></a>Merk at når labelen avsluttes med ~ (uttales "tilde") indikerer det at teksten er avkortet i outputvinduet. Du får opp hele teksten ved å bruke *val_label()* slik: </span>
<span id="cb51-205"><a href="#cb51-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-208"><a href="#cb51-208" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-209"><a href="#cb51-209" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-210"><a href="#cb51-210" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-211"><a href="#cb51-211" aria-hidden="true" tabindex="-1"></a><span class="fu">var_label</span>(norlag<span class="sc">$</span>inwyrkinnt)</span>
<span id="cb51-212"><a href="#cb51-212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-213"><a href="#cb51-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-214"><a href="#cb51-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-215"><a href="#cb51-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-216"><a href="#cb51-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-217"><a href="#cb51-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-218"><a href="#cb51-218" aria-hidden="true" tabindex="-1"></a><span class="fu">## Omkode variable som er labelled  </span></span>
<span id="cb51-219"><a href="#cb51-219" aria-hidden="true" tabindex="-1"></a>Noen ganger vil vi omkode en variabel. Et eksempel er variabelen he104. Her er innholdet i den variabelen. </span>
<span id="cb51-220"><a href="#cb51-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-223"><a href="#cb51-223" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-224"><a href="#cb51-224" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-225"><a href="#cb51-225" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-226"><a href="#cb51-226" aria-hidden="true" tabindex="-1"></a>memisc<span class="sc">::</span><span class="fu">codebook</span>(norlag<span class="sc">$</span>he104)</span>
<span id="cb51-227"><a href="#cb51-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-228"><a href="#cb51-228" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-229"><a href="#cb51-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-230"><a href="#cb51-230" aria-hidden="true" tabindex="-1"></a>Legg merke til at de tre nederste verdiene egentlig er varianter av å mangle data. Disse verdiene skal normalt ikke være med i en videre analyse, men er "missing". Vi bør fortelle R at disse verdiene ikke skal tas med videre ved å omkode til NA. </span>
<span id="cb51-231"><a href="#cb51-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-232"><a href="#cb51-232" aria-hidden="true" tabindex="-1"></a>Følgende kode gjør en omkoding til NA. I eksempelet har jeg lagt inn linjeskift for mutate() for å tydeliggjøre de ulike delene. </span>
<span id="cb51-233"><a href="#cb51-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-234"><a href="#cb51-234" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Første linje lager en ny variabel he104b som skal inne en kopi av he104. Funksjonen *replace()* tar så utgangspunkt i variabelen he104, og de verdiene som ikke er angitt at skal byttes ut vil beholdes fra denne.  </span>
<span id="cb51-235"><a href="#cb51-235" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Andre linje sier at hvis variabelen he104 er en av verdiene 999, 99999, eller 999999, så... </span>
<span id="cb51-236"><a href="#cb51-236" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>sier tredje linje at da skal de få verdien NA i stedet. </span>
<span id="cb51-237"><a href="#cb51-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-238"><a href="#cb51-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-241"><a href="#cb51-241" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-242"><a href="#cb51-242" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-243"><a href="#cb51-243" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-244"><a href="#cb51-244" aria-hidden="true" tabindex="-1"></a>norlag <span class="sc">%&gt;%</span> </span>
<span id="cb51-245"><a href="#cb51-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">he104b =</span> <span class="fu">replace</span>(he104, </span>
<span id="cb51-246"><a href="#cb51-246" aria-hidden="true" tabindex="-1"></a>                         he104 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">999</span>, <span class="dv">99999</span>, <span class="dv">999999</span>), </span>
<span id="cb51-247"><a href="#cb51-247" aria-hidden="true" tabindex="-1"></a>                         <span class="cn">NA</span>)) <span class="sc">%&gt;%</span>  </span>
<span id="cb51-248"><a href="#cb51-248" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(he104b) <span class="sc">%&gt;%</span> </span>
<span id="cb51-249"><a href="#cb51-249" aria-hidden="true" tabindex="-1"></a>  memisc<span class="sc">::</span><span class="fu">codebook</span>()</span>
<span id="cb51-250"><a href="#cb51-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-251"><a href="#cb51-251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-252"><a href="#cb51-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-253"><a href="#cb51-253" aria-hidden="true" tabindex="-1"></a>Legg merke til at output nå har de omtalte verdiene 0 observasjoner, men lablene finnes i variabelen likevel! Lablene eksisterer altså uavhengig av verdiene i variabelen, men det har kommet en linje til med verdien NA. Det er det det ble omkodet til. </span>
<span id="cb51-254"><a href="#cb51-254" aria-hidden="true" tabindex="-1"></a>Nå trenger vi jo ikke de lablene vi omkodet, så de kan fjernes helt. Funksjoen *drop_unused_value_labels()* gjør akkurat det det høres ut som. Her er et eksempel: </span>
<span id="cb51-255"><a href="#cb51-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-258"><a href="#cb51-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-259"><a href="#cb51-259" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-260"><a href="#cb51-260" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-261"><a href="#cb51-261" aria-hidden="true" tabindex="-1"></a>norlag <span class="sc">%&gt;%</span> </span>
<span id="cb51-262"><a href="#cb51-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(he104) <span class="sc">%&gt;%</span> </span>
<span id="cb51-263"><a href="#cb51-263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">he104 =</span> <span class="fu">replace</span>(he104, </span>
<span id="cb51-264"><a href="#cb51-264" aria-hidden="true" tabindex="-1"></a>                         he104 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">999</span>, <span class="dv">99999</span>, <span class="dv">999999</span>), </span>
<span id="cb51-265"><a href="#cb51-265" aria-hidden="true" tabindex="-1"></a>                         <span class="cn">NA</span>)) <span class="sc">%&gt;%</span>  </span>
<span id="cb51-266"><a href="#cb51-266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_unused_value_labels</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb51-267"><a href="#cb51-267" aria-hidden="true" tabindex="-1"></a>  memisc<span class="sc">::</span><span class="fu">codebook</span>()</span>
<span id="cb51-268"><a href="#cb51-268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-269"><a href="#cb51-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-270"><a href="#cb51-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-271"><a href="#cb51-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-272"><a href="#cb51-272" aria-hidden="true" tabindex="-1"></a><span class="fu">### Alternativ: legg til user-specified-na</span></span>
<span id="cb51-273"><a href="#cb51-273" aria-hidden="true" tabindex="-1"></a>En alternativ fremgangsmåte er mer slik man ville gjort i annen software ved at man definerer disse verdiene som "missing", dvs NA. Funksjonen *set_na_values()* definerer hvilke verdier som skal regnes som NA, men uten å endre lablene eller kode om på annen måte. </span>
<span id="cb51-274"><a href="#cb51-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-275"><a href="#cb51-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-278"><a href="#cb51-278" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-279"><a href="#cb51-279" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-280"><a href="#cb51-280" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-281"><a href="#cb51-281" aria-hidden="true" tabindex="-1"></a>norlag <span class="sc">%&gt;%</span> </span>
<span id="cb51-282"><a href="#cb51-282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(he104) <span class="sc">%&gt;%</span> </span>
<span id="cb51-283"><a href="#cb51-283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_na_values</span>(<span class="at">he104 =</span> <span class="fu">c</span>(<span class="dv">999</span>, <span class="dv">99999</span>, <span class="dv">999999</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb51-284"><a href="#cb51-284" aria-hidden="true" tabindex="-1"></a>  memisc<span class="sc">::</span><span class="fu">codebook</span>()</span>
<span id="cb51-285"><a href="#cb51-285" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-286"><a href="#cb51-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-287"><a href="#cb51-287" aria-hidden="true" tabindex="-1"></a>I output står det nå en "M" mellom verdien og labelen, som angir at dette er "Missing". I frekvenstabellen er det nå i prosentueringen skilt mellom *Valid* og *Total*, der missing altså ikke er regnet med blant gyldige verdier. </span>
<span id="cb51-288"><a href="#cb51-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-289"><a href="#cb51-289" aria-hidden="true" tabindex="-1"></a>Men det er ryddigst å fjerne disse missing-verdiene og sette de til NA. Funksjonen *zap_na()* gjør disse verdiene om til NA, altså omkoder alle missingverdiene til NA. Som i forrige variant vil da lablene fremdeles eksistere, men disse kan fjernes på samme måte med *drop_unused_value_labels()*.  </span>
<span id="cb51-290"><a href="#cb51-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-293"><a href="#cb51-293" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-294"><a href="#cb51-294" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-295"><a href="#cb51-295" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-296"><a href="#cb51-296" aria-hidden="true" tabindex="-1"></a>norlag <span class="sc">%&gt;%</span> </span>
<span id="cb51-297"><a href="#cb51-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(he104) <span class="sc">%&gt;%</span> </span>
<span id="cb51-298"><a href="#cb51-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_na_values</span>(<span class="at">he104 =</span> <span class="fu">c</span>(<span class="dv">999</span>, <span class="dv">99999</span>, <span class="dv">999999</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb51-299"><a href="#cb51-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">zap_missing</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb51-300"><a href="#cb51-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_unused_value_labels</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb51-301"><a href="#cb51-301" aria-hidden="true" tabindex="-1"></a>  memisc<span class="sc">::</span><span class="fu">codebook</span>()</span>
<span id="cb51-302"><a href="#cb51-302" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-303"><a href="#cb51-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-304"><a href="#cb51-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-305"><a href="#cb51-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-306"><a href="#cb51-306" aria-hidden="true" tabindex="-1"></a><span class="fu">## Omkoding av andre verdier</span></span>
<span id="cb51-307"><a href="#cb51-307" aria-hidden="true" tabindex="-1"></a>Vi starter med å lagre de endringene som ble testet ut over, og lagrer disse i et nytt datasett som kalles *norlag2* som vi bruker videre i eksemplene. </span>
<span id="cb51-308"><a href="#cb51-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-311"><a href="#cb51-311" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-312"><a href="#cb51-312" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-313"><a href="#cb51-313" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-314"><a href="#cb51-314" aria-hidden="true" tabindex="-1"></a>norlag2 <span class="ot">&lt;-</span> norlag <span class="sc">%&gt;%</span> </span>
<span id="cb51-315"><a href="#cb51-315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(he104) <span class="sc">%&gt;%</span> </span>
<span id="cb51-316"><a href="#cb51-316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">he104 =</span> <span class="fu">replace</span>(he104, </span>
<span id="cb51-317"><a href="#cb51-317" aria-hidden="true" tabindex="-1"></a>                         he104 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">999</span>, <span class="dv">99999</span>, <span class="dv">999999</span>), </span>
<span id="cb51-318"><a href="#cb51-318" aria-hidden="true" tabindex="-1"></a>                         <span class="cn">NA</span>)) <span class="sc">%&gt;%</span>  </span>
<span id="cb51-319"><a href="#cb51-319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_unused_value_labels</span>() </span>
<span id="cb51-320"><a href="#cb51-320" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-321"><a href="#cb51-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-322"><a href="#cb51-322" aria-hidden="true" tabindex="-1"></a>La oss si at vi det er mindre viktig om man har det romslig eller veldig romslig. Det er heller ikke så viktig å skille mellom de som 'problemer' og de som har det 'svært vanskelig'. Da ønsker vi å slå sammen disse kategoriene. </span>
<span id="cb51-323"><a href="#cb51-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-324"><a href="#cb51-324" aria-hidden="true" tabindex="-1"></a>For å omkode en variabel som har labler kan vi bruke **recode()**. Det gjør vi typisk innenfor en mutate-setning. </span>
<span id="cb51-325"><a href="#cb51-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-326"><a href="#cb51-326" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Første linje sier at det skal lages en ny variabel, som er en rekodet variant av he104</span>
<span id="cb51-327"><a href="#cb51-327" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Andre linje sier at alle med verdien 1 skal gjøres om til verdien 2</span>
<span id="cb51-328"><a href="#cb51-328" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Tredje linje sier at alle med verdien 5 skal gjøres om til verdien 4</span>
<span id="cb51-329"><a href="#cb51-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-330"><a href="#cb51-330" aria-hidden="true" tabindex="-1"></a>Legg merke til at den opprinneligve verdien angis innenfor apostrof <span class="in">`1`</span>, mens den nye verdien ikke skal angis med apostrof. </span>
<span id="cb51-331"><a href="#cb51-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-334"><a href="#cb51-334" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-335"><a href="#cb51-335" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-336"><a href="#cb51-336" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-337"><a href="#cb51-337" aria-hidden="true" tabindex="-1"></a>norlag2 <span class="sc">%&gt;%</span> </span>
<span id="cb51-338"><a href="#cb51-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">okonomi =</span> <span class="fu">recode</span>(he104, </span>
<span id="cb51-339"><a href="#cb51-339" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">2</span> ,</span>
<span id="cb51-340"><a href="#cb51-340" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">5</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">4</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb51-341"><a href="#cb51-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(okonomi) <span class="sc">%&gt;%</span> </span>
<span id="cb51-342"><a href="#cb51-342" aria-hidden="true" tabindex="-1"></a>  memisc<span class="sc">::</span><span class="fu">codebook</span>()</span>
<span id="cb51-343"><a href="#cb51-343" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-344"><a href="#cb51-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-345"><a href="#cb51-345" aria-hidden="true" tabindex="-1"></a>Legg merke til at de opprinnelge lablene fremdeles er der, men to av kategoriene har nå null observasjoner. Det innebærer jo også at lablene er litt misvisende, for det er jo egentlig kombinasjoner. </span>
<span id="cb51-346"><a href="#cb51-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-347"><a href="#cb51-347" aria-hidden="true" tabindex="-1"></a>Å omkode lablene kan også gjøres. Funksjonen *add_value_labels()* angir hvilken variabel lablene skal angis for, og så settes ny label og hvilken verdi det tilsvarer. Lablene for verdier som ikke er nevnt blir beholdt slik de er. </span>
<span id="cb51-348"><a href="#cb51-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-351"><a href="#cb51-351" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-352"><a href="#cb51-352" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-353"><a href="#cb51-353" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-354"><a href="#cb51-354" aria-hidden="true" tabindex="-1"></a>norlag2 <span class="sc">%&gt;%</span> </span>
<span id="cb51-355"><a href="#cb51-355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">he104 =</span> <span class="fu">recode</span>(he104, </span>
<span id="cb51-356"><a href="#cb51-356" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">2</span> ,</span>
<span id="cb51-357"><a href="#cb51-357" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">5</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">4</span>,</span>
<span id="cb51-358"><a href="#cb51-358" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.combine_value_labels =</span> <span class="cn">TRUE</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb51-359"><a href="#cb51-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(he104) <span class="sc">%&gt;%</span> </span>
<span id="cb51-360"><a href="#cb51-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_value_labels</span>(<span class="at">he104 =</span> <span class="fu">c</span>(<span class="st">"Romslig/veldig romslig"</span> <span class="ot">=</span> <span class="dv">2</span>, </span>
<span id="cb51-361"><a href="#cb51-361" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"Problemer/store problemer"</span> <span class="ot">=</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-362"><a href="#cb51-362" aria-hidden="true" tabindex="-1"></a>  memisc<span class="sc">::</span><span class="fu">codebook</span>()</span>
<span id="cb51-363"><a href="#cb51-363" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-364"><a href="#cb51-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-365"><a href="#cb51-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-366"><a href="#cb51-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-367"><a href="#cb51-367" aria-hidden="true" tabindex="-1"></a><span class="fu">## Konverter variable til et mer ordinært R-format </span></span>
<span id="cb51-368"><a href="#cb51-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-369"><a href="#cb51-369" aria-hidden="true" tabindex="-1"></a>Vi starter med å lagre en kopi av datasettet med endrede labler. </span>
<span id="cb51-370"><a href="#cb51-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-373"><a href="#cb51-373" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-374"><a href="#cb51-374" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-375"><a href="#cb51-375" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-376"><a href="#cb51-376" aria-hidden="true" tabindex="-1"></a>norlag3 <span class="ot">&lt;-</span> norlag2 <span class="sc">%&gt;%</span> </span>
<span id="cb51-377"><a href="#cb51-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">he104 =</span> <span class="fu">recode</span>(he104, </span>
<span id="cb51-378"><a href="#cb51-378" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">2</span> ,</span>
<span id="cb51-379"><a href="#cb51-379" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">5</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">4</span>,</span>
<span id="cb51-380"><a href="#cb51-380" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.combine_value_labels =</span> <span class="cn">TRUE</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb51-381"><a href="#cb51-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_value_labels</span>(<span class="at">he104 =</span> <span class="fu">c</span>(<span class="st">"Romslig/veldig romslig"</span> <span class="ot">=</span> <span class="dv">2</span>, </span>
<span id="cb51-382"><a href="#cb51-382" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"Problemer/store problemer"</span> <span class="ot">=</span> <span class="dv">4</span>))</span>
<span id="cb51-383"><a href="#cb51-383" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-384"><a href="#cb51-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-385"><a href="#cb51-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-386"><a href="#cb51-386" aria-hidden="true" tabindex="-1"></a>Men hva skjer når vi skal lage en fin tabell? Vi prøver med {gtsummary} og *tbl_summary()*. </span>
<span id="cb51-387"><a href="#cb51-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-390"><a href="#cb51-390" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-391"><a href="#cb51-391" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-392"><a href="#cb51-392" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-393"><a href="#cb51-393" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb51-394"><a href="#cb51-394" aria-hidden="true" tabindex="-1"></a>norlag3 <span class="sc">%&gt;%</span> </span>
<span id="cb51-395"><a href="#cb51-395" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_summary</span>(<span class="at">include =</span> he104)</span>
<span id="cb51-396"><a href="#cb51-396" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-397"><a href="#cb51-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-398"><a href="#cb51-398" aria-hidden="true" tabindex="-1"></a>Tabellen vises altså uten lablene! Noe av poenget med å ha labler var jo å at det skal syens... Siden mange funksjoner i R i utgangspunktet ikke er laget for labler er det rett og slett ikke støttet.  </span>
<span id="cb51-399"><a href="#cb51-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-400"><a href="#cb51-400" aria-hidden="true" tabindex="-1"></a>Men vi kan gjøre om variabelen med *as_factor()*. Gjør om lablene til faktor-nivåer og så lage en tabell med den endrede variabelen. </span>
<span id="cb51-401"><a href="#cb51-401" aria-hidden="true" tabindex="-1"></a>(OBS! funskjonen *as.factor()* gjør bare nesten det samme. *as_factor()* er laget bl.a. for å håndtere labler, mens *as.factor()* ikke gjør det).</span>
<span id="cb51-402"><a href="#cb51-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-405"><a href="#cb51-405" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-406"><a href="#cb51-406" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-407"><a href="#cb51-407" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-408"><a href="#cb51-408" aria-hidden="true" tabindex="-1"></a>norlag3 <span class="sc">%&gt;%</span> </span>
<span id="cb51-409"><a href="#cb51-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">he104 =</span> <span class="fu">as_factor</span>(he104)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-410"><a href="#cb51-410" aria-hidden="true" tabindex="-1"></a>  gtsummary<span class="sc">::</span><span class="fu">tbl_summary</span>(<span class="at">include =</span> he104)</span>
<span id="cb51-411"><a href="#cb51-411" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-412"><a href="#cb51-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-413"><a href="#cb51-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-414"><a href="#cb51-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-415"><a href="#cb51-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-416"><a href="#cb51-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-417"><a href="#cb51-417" aria-hidden="true" tabindex="-1"></a><span class="fu">## Hvordan gjøre alt i en fei: alle variable samtidig </span></span>
<span id="cb51-418"><a href="#cb51-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-419"><a href="#cb51-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-420"><a href="#cb51-420" aria-hidden="true" tabindex="-1"></a>For NorLAG er det noen missingverdier som er definert på tvers av hele datasettet. Se dokumentasjon her: https://norlag.nsd.no/filterverdier </span>
<span id="cb51-421"><a href="#cb51-421" aria-hidden="true" tabindex="-1"></a>Å gjøre de operasjonene vi gjorde over for hver enkelt av de over 400 variablene er utrolig arbeidskrevende og drit kjedelig. Så det gidder vi ikke. Men å omkode alle variable i et helt datasett krever litt mer avanserte operasjoner. Her bruker vi *across()* som angir at vi skal gjøre samme operasjon på de nærere angitte variablene. Vi kan enten gi en liste med variabelnavn, eller sette et krav om at variablene skal være av en viss type, starte med visse bokstaver eller tegn osv. I eksempelet nedenfor angir vi bare at variabelene skal være av typen 'labelled', noe de aller fleste er. Missing-verdiene i datasettet er jo felles for alle variable, så da kan vi bruke replace() og sette disse til NA. Her er et eksempel:</span>
<span id="cb51-422"><a href="#cb51-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-423"><a href="#cb51-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-426"><a href="#cb51-426" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-427"><a href="#cb51-427" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-428"><a href="#cb51-428" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-429"><a href="#cb51-429" aria-hidden="true" tabindex="-1"></a>norlag4 <span class="ot">&lt;-</span> norlag <span class="sc">%&gt;%</span> </span>
<span id="cb51-430"><a href="#cb51-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>( <span class="fu">where</span>(is.labelled) ,  <span class="sc">~</span><span class="fu">replace</span>(., </span>
<span id="cb51-431"><a href="#cb51-431" aria-hidden="true" tabindex="-1"></a>                                        . <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">997</span>, <span class="dv">998</span>, <span class="dv">999</span>, <span class="dv">99999</span>, <span class="dv">999999</span>), </span>
<span id="cb51-432"><a href="#cb51-432" aria-hidden="true" tabindex="-1"></a>                                        <span class="cn">NA</span>))) <span class="sc">%&gt;%</span>  </span>
<span id="cb51-433"><a href="#cb51-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_unused_value_labels</span>()                                           </span>
<span id="cb51-434"><a href="#cb51-434" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-435"><a href="#cb51-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-436"><a href="#cb51-436" aria-hidden="true" tabindex="-1"></a>I mutate-setningen skjer følgende: </span>
<span id="cb51-437"><a href="#cb51-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-438"><a href="#cb51-438" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>across() sier at vi skal gjøre det samme for flere variable, spesifisert med *where(is.labelled)*. </span>
<span id="cb51-439"><a href="#cb51-439" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>for disse skal vi bruke replace(), angitt ved ~replace()</span>
<span id="cb51-440"><a href="#cb51-440" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>inni parentesen angis . som hver av de variablene som er plukket ut i across(). Så for disse variablene skal det byttes ut verdier</span>
<span id="cb51-441"><a href="#cb51-441" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>neste linje starter med ., som igjen henviser til de samme variablen, og hvis de har en av de opplistede verdiene</span>
<span id="cb51-442"><a href="#cb51-442" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>i så fall får de ny verdi NA</span>
<span id="cb51-443"><a href="#cb51-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-444"><a href="#cb51-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-445"><a href="#cb51-445" aria-hidden="true" tabindex="-1"></a>Dermed er samtlige labelled-variable omkodet på denne måten i en fei. </span>
<span id="cb51-446"><a href="#cb51-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-447"><a href="#cb51-447" aria-hidden="true" tabindex="-1"></a>Da kan vi lage en tabell på nytt. Her får vi samme problem med at lablene ikke synes, men missing-verdiene er i hvetr fall ryddet opp i.</span>
<span id="cb51-448"><a href="#cb51-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-451"><a href="#cb51-451" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-452"><a href="#cb51-452" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-453"><a href="#cb51-453" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-454"><a href="#cb51-454" aria-hidden="true" tabindex="-1"></a>norlag4 <span class="sc">%&gt;%</span> </span>
<span id="cb51-455"><a href="#cb51-455" aria-hidden="true" tabindex="-1"></a>  gtsummary<span class="sc">::</span><span class="fu">tbl_summary</span>(<span class="at">include =</span> he104)</span>
<span id="cb51-456"><a href="#cb51-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-457"><a href="#cb51-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-458"><a href="#cb51-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-459"><a href="#cb51-459" aria-hidden="true" tabindex="-1"></a>Vi kan selvfølgelig endre til factor som gjort over, men da får vi igjen et problem med å gjøre det en variabel om gangen. Igjen: det gidder vi ikke. I stedet bruker vi en enkel funksjon som fikser biffen for hele datasettet, nemlig *unlabelled()*.  </span>
<span id="cb51-460"><a href="#cb51-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-461"><a href="#cb51-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-464"><a href="#cb51-464" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-465"><a href="#cb51-465" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-466"><a href="#cb51-466" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-467"><a href="#cb51-467" aria-hidden="true" tabindex="-1"></a>norlag4 <span class="sc">%&gt;%</span> </span>
<span id="cb51-468"><a href="#cb51-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlabelled</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb51-469"><a href="#cb51-469" aria-hidden="true" tabindex="-1"></a>  gtsummary<span class="sc">::</span><span class="fu">tbl_summary</span>(<span class="at">include =</span> he104)</span>
<span id="cb51-470"><a href="#cb51-470" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-471"><a href="#cb51-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-472"><a href="#cb51-472" aria-hidden="true" tabindex="-1"></a>OBS! Unlabelled endrer alle labelled-variablene. Det er ikke sikkert at vi vil det. Spesielt gjelder det at det kan være andre labler knyttet til variable som skal være kontinuerlige. Men: hvis man har gjort en god opprydning i datasetet i forkant, med de omkodinger som trengs (det må nok gjøres en for en variabel), så er dette ganske greit. </span>
<span id="cb51-473"><a href="#cb51-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-474"><a href="#cb51-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-475"><a href="#cb51-475" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sett det hele sammen: fiks hele skiten i en fei</span></span>
<span id="cb51-476"><a href="#cb51-476" aria-hidden="true" tabindex="-1"></a>Hvert steg ovenfor blir ganske omstendelig, og det ser vanskeligere ut enn det er. Her er en kode som setter det hele sammen i ett steg. </span>
<span id="cb51-477"><a href="#cb51-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-478"><a href="#cb51-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-481"><a href="#cb51-481" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-482"><a href="#cb51-482" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-483"><a href="#cb51-483" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-484"><a href="#cb51-484" aria-hidden="true" tabindex="-1"></a>norlag <span class="ot">&lt;-</span> <span class="fu">read_stata</span>(<span class="st">"data/norlag_panel2022.dta"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb51-485"><a href="#cb51-485" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>( <span class="fu">where</span>(is.labelled) ,  <span class="sc">~</span><span class="fu">replace</span>(., </span>
<span id="cb51-486"><a href="#cb51-486" aria-hidden="true" tabindex="-1"></a>                                        . <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">997</span>, <span class="dv">998</span>, <span class="dv">999</span>, <span class="dv">99999</span>, <span class="dv">999999</span>), </span>
<span id="cb51-487"><a href="#cb51-487" aria-hidden="true" tabindex="-1"></a>                                        <span class="cn">NA</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb51-488"><a href="#cb51-488" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Her kan ymse omkodinger av labeelled data gjøres: </span></span>
<span id="cb51-489"><a href="#cb51-489" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">he104 =</span> <span class="fu">recode</span>(he104, </span>
<span id="cb51-490"><a href="#cb51-490" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">2</span> ,</span>
<span id="cb51-491"><a href="#cb51-491" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">5</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">4</span>,</span>
<span id="cb51-492"><a href="#cb51-492" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.combine_value_labels =</span> <span class="cn">TRUE</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb51-493"><a href="#cb51-493" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Her kan endrer du lablene hvis det trengs for de samme variablene: </span></span>
<span id="cb51-494"><a href="#cb51-494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_value_labels</span>(<span class="at">he104 =</span> <span class="fu">c</span>(<span class="st">"Romslig/veldig romslig"</span> <span class="ot">=</span> <span class="dv">2</span>, </span>
<span id="cb51-495"><a href="#cb51-495" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"Problemer/store problemer"</span> <span class="ot">=</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-496"><a href="#cb51-496" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For hele datasettet fjernes ikke-brukte labler </span></span>
<span id="cb51-497"><a href="#cb51-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_unused_value_labels</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb51-498"><a href="#cb51-498" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Så gjør alle variable om til mer ordinære R-format. Dvs. gjøres labler om til factor</span></span>
<span id="cb51-499"><a href="#cb51-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlabelled</span>()</span>
<span id="cb51-500"><a href="#cb51-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-501"><a href="#cb51-501" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-502"><a href="#cb51-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-503"><a href="#cb51-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-504"><a href="#cb51-504" aria-hidden="true" tabindex="-1"></a>Så kan du gjøre andre analyser etter dette. Hvis du trenger å gå tilbake for å omkode flere labelled-variable, så legges dette til i mutate-setningen over. Det er lurt å gjøre all den typen omkoding ett sted, slik at du får et datasett som er ferdig ryddet og klart til andre analyser. </span>
<span id="cb51-505"><a href="#cb51-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-506"><a href="#cb51-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-507"><a href="#cb51-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-508"><a href="#cb51-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-509"><a href="#cb51-509" aria-hidden="true" tabindex="-1"></a><span class="fu">## Omkoding av factor-variable </span></span>
<span id="cb51-510"><a href="#cb51-510" aria-hidden="true" tabindex="-1"></a>Noen ganger har man et datasett som allerede er omgjort med factor-variable. Eller du har en eller annen grunn til å ikke gå tilbake til et tidligere steg for å omkode. Men du har factor-levels med skikkelig lang tekst kan det være noe drit å kode om. Kan man gjøre dette på en lurere måte? Minst mulig tårer? Ja, selvsagt. </span>
<span id="cb51-511"><a href="#cb51-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-512"><a href="#cb51-512" aria-hidden="true" tabindex="-1"></a>I NorLAG er variabelen wr117zz svar på et spørsmål om "Mulighet for å redusert arbeidstid (deltid)". Når denne variabelen er gjort om til factor kan man se hvilke verdier variabelen har med bruke av funksjonen *levels()* slik: </span>
<span id="cb51-513"><a href="#cb51-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-516"><a href="#cb51-516" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-517"><a href="#cb51-517" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-518"><a href="#cb51-518" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-519"><a href="#cb51-519" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(norlag<span class="sc">$</span>wr117zz)</span>
<span id="cb51-520"><a href="#cb51-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-521"><a href="#cb51-521" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(norlag<span class="sc">$</span>wr117zz)</span>
<span id="cb51-522"><a href="#cb51-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-523"><a href="#cb51-523" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-524"><a href="#cb51-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-525"><a href="#cb51-525" aria-hidden="true" tabindex="-1"></a>La oss si at vi vil kode om slik at vi får en variabel som bare er om vedkommende har mulighet til å jobbe deltid eller ikke. De som allerede jobber deltid har jo åpenbart mulighet til det, så de skal kodes om til "Ja". De andre kategoriene er egentlig grunner til at det mangler data, så de skal settes til NA. En mulighet er da å omkode som følger: </span>
<span id="cb51-526"><a href="#cb51-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-529"><a href="#cb51-529" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-530"><a href="#cb51-530" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-531"><a href="#cb51-531" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-532"><a href="#cb51-532" aria-hidden="true" tabindex="-1"></a>norlag_omkodet <span class="ot">&lt;-</span> norlag <span class="sc">%&gt;%</span></span>
<span id="cb51-533"><a href="#cb51-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">redarbtid =</span> <span class="fu">replace</span>(wr117zz, wr117zz <span class="sc">==</span> <span class="st">"filter: jobber deltid"</span>, <span class="st">"Ja"</span>), </span>
<span id="cb51-534"><a href="#cb51-534" aria-hidden="true" tabindex="-1"></a>         <span class="at">redarbtid =</span> <span class="fu">replace</span>(redarbtid, redarbtid <span class="sc">==</span> <span class="st">"filter: selvstendig næringsdrivende (NorLAG3 inkl frilanser/annet)"</span>, <span class="cn">NA</span>), </span>
<span id="cb51-535"><a href="#cb51-535" aria-hidden="true" tabindex="-1"></a>         <span class="at">redarbtid =</span> <span class="fu">replace</span>(redarbtid, redarbtid <span class="sc">==</span> <span class="st">"filter: ikke i arbeid"</span>, <span class="cn">NA</span>), </span>
<span id="cb51-536"><a href="#cb51-536" aria-hidden="true" tabindex="-1"></a>         <span class="at">redarbtid =</span> <span class="fu">replace</span>(redarbtid, redarbtid <span class="sc">==</span> <span class="st">"vil ikke svare"</span>, <span class="cn">NA</span>),</span>
<span id="cb51-537"><a href="#cb51-537" aria-hidden="true" tabindex="-1"></a>         <span class="at">redarbtid =</span> <span class="fu">replace</span>(redarbtid, redarbtid <span class="sc">==</span> <span class="st">"vet ikke"</span>, <span class="cn">NA</span>),</span>
<span id="cb51-538"><a href="#cb51-538" aria-hidden="true" tabindex="-1"></a>         <span class="at">redarbtid =</span> <span class="fu">replace</span>(redarbtid, redarbtid <span class="sc">==</span> <span class="st">"mangler data"</span>, <span class="cn">NA</span>),</span>
<span id="cb51-539"><a href="#cb51-539" aria-hidden="true" tabindex="-1"></a>         <span class="at">redarbtid =</span> <span class="fu">replace</span>(redarbtid, redarbtid <span class="sc">==</span> <span class="st">"Deltok ikke i runden"</span>, <span class="cn">NA</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-540"><a href="#cb51-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>()</span>
<span id="cb51-541"><a href="#cb51-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-542"><a href="#cb51-542" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-543"><a href="#cb51-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-544"><a href="#cb51-544" aria-hidden="true" tabindex="-1"></a>Dette funker, men blir ganske mye tekst å skrive, og da kan man også lett gjøre skrivefeil. Husk at faktornivåene må angis helt nøyaktig slik de er skrevet! </span>
<span id="cb51-545"><a href="#cb51-545" aria-hidden="true" tabindex="-1"></a>Merk at den siste funksjone, *droplevels()*, bare fjerner faktor-levels som ikke er i bruk. </span>
<span id="cb51-546"><a href="#cb51-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-547"><a href="#cb51-547" aria-hidden="true" tabindex="-1"></a>I output for faktor-levels angir klammeparentesen gir rekkefølgen på disse verdiene. Vi kan bruke denne informasjonen direkte i omkodingen for å unngå å skrive så veldig mye. Når man bruker levels() får man en liten vektor med verdier, og disse kan man altså henvise til med rekkefølgen. Her er et eksempel for bare å bytte ut de som jobber deltid til "Ja": </span>
<span id="cb51-548"><a href="#cb51-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-549"><a href="#cb51-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-552"><a href="#cb51-552" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-553"><a href="#cb51-553" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-554"><a href="#cb51-554" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-555"><a href="#cb51-555" aria-hidden="true" tabindex="-1"></a>norlag_omkodet <span class="ot">&lt;-</span> norlag <span class="sc">%&gt;%</span></span>
<span id="cb51-556"><a href="#cb51-556" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">redarbtid =</span> <span class="fu">replace</span>(wr117zz, wr117zz <span class="sc">==</span> <span class="fu">levels</span>(wr117zz)[<span class="dv">3</span>], <span class="st">"Ja"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-557"><a href="#cb51-557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>()</span>
<span id="cb51-558"><a href="#cb51-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-559"><a href="#cb51-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-560"><a href="#cb51-560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-561"><a href="#cb51-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-562"><a href="#cb51-562" aria-hidden="true" tabindex="-1"></a>Trikset her er altså å bruke levels() og vise til hvilket nummer i rekkefølgen. Da unngår vi også faren for skrivefeil.  </span>
<span id="cb51-563"><a href="#cb51-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-564"><a href="#cb51-564" aria-hidden="true" tabindex="-1"></a>Vi vil også kode om alle de andre verdiene, nummer 4-9 til NA. Det kan vi gjøre på samme måte, men vi behøver ikke skrive en ny linje for hver verdi. Den logiske operatoren == kan man bruke når man skal sjekke om to verdier er like. Hvis vi skal se om en verdi er lik en av flere mulige kan vi bruke %in% og så en liste med verdier. levels() gir en liste med verdier, så da kan vi angi den direkte og alle verdiene 4 til 9 ved å skrive 4:9. Samlet blir det da slik: </span>
<span id="cb51-565"><a href="#cb51-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-568"><a href="#cb51-568" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-569"><a href="#cb51-569" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb51-570"><a href="#cb51-570" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb51-571"><a href="#cb51-571" aria-hidden="true" tabindex="-1"></a>norlag_omkodet <span class="ot">&lt;-</span> norlag <span class="sc">%&gt;%</span></span>
<span id="cb51-572"><a href="#cb51-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">redarbtid =</span> <span class="fu">replace</span>(wr117zz, wr117zz <span class="sc">==</span> <span class="fu">levels</span>(wr117zz)[<span class="dv">3</span>], <span class="st">"Ja"</span>), </span>
<span id="cb51-573"><a href="#cb51-573" aria-hidden="true" tabindex="-1"></a>         <span class="at">redarbtid =</span> <span class="fu">replace</span>(redarbtid, redarbtid <span class="sc">%in%</span> <span class="fu">levels</span>(wr117zz)[<span class="dv">4</span><span class="sc">:</span><span class="dv">9</span>], <span class="cn">NA</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-574"><a href="#cb51-574" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>()</span>
<span id="cb51-575"><a href="#cb51-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-576"><a href="#cb51-576" aria-hidden="true" tabindex="-1"></a>memisc<span class="sc">::</span><span class="fu">codebook</span>(norlag_omkodet<span class="sc">$</span>redarbtid)</span>
<span id="cb51-577"><a href="#cb51-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-578"><a href="#cb51-578" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-579"><a href="#cb51-579" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>